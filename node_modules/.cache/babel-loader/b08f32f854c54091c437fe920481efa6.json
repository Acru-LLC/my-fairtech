{"remainingRequest":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\report\\collection\\assemble\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\src\\modules\\report\\collection\\assemble\\index.vue","mtime":1674799497847},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\babel.config.js","mtime":1667352074157},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1675061970665},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1667355378280},{"path":"C:\\ACRU PROJECT\\Fair Tech\\acru-frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1675061970715}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiQzovQUNSVSBQUk9KRUNUL0ZhaXIgVGVjaC9hY3J1LWZyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YuanMiOwppbXBvcnQgX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIgZnJvbSAiQzovQUNSVSBQUk9KRUNUL0ZhaXIgVGVjaC9hY3J1LWZyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyLmpzIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiQzovQUNSVSBQUk9KRUNUL0ZhaXIgVGVjaC9hY3J1LWZyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyLmpzIjsKaW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiQzovQUNSVSBQUk9KRUNUL0ZhaXIgVGVjaC9hY3J1LWZyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9yZWdlbmVyYXRvclJ1bnRpbWUuanMiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiQzovQUNSVSBQUk9KRUNUL0ZhaXIgVGVjaC9hY3J1LWZyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmpzb24uc3RyaW5naWZ5LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIudG8tZml4ZWQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CmltcG9ydCByZXBvcnRTZXJ2aWNlIGZyb20gIi4uLy4uL3JlcG9ydFNlcnZpY2UiOwppbXBvcnQgcmVwb3J0SGVhZGVyIGZyb20gIi4vcmVwb3J0SGVhZGVyIjsKaW1wb3J0IFhMU1ggZnJvbSAieGxzeCI7CmltcG9ydCBCYXNlSW5wdXRXaXRoVmFsaWRhdGlvbiBmcm9tICJAL2NvbXBvbmVudHMvYmFzZS9CYXNlSW5wdXRXaXRoVmFsaWRhdGlvbiI7CmltcG9ydCBCYXNlRGF0ZVBpY2tlcldpdGhWYWxpZGF0aW9uIGZyb20gIkAvY29tcG9uZW50cy9iYXNlL0Jhc2VEYXRlUGlja2VyV2l0aFZhbGlkYXRpb24iOwppbXBvcnQgY3J1ZEFuZExpc3RzU2VydmljZSBmcm9tICJAL3NoYXJlZC9zZXJ2aWNlcy9jcnVkX2FuZF9saXN0LnNlcnZpY2UiOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgQmFzZURhdGVQaWNrZXJXaXRoVmFsaWRhdGlvbjogQmFzZURhdGVQaWNrZXJXaXRoVmFsaWRhdGlvbiwKICAgIEJhc2VJbnB1dFdpdGhWYWxpZGF0aW9uOiBCYXNlSW5wdXRXaXRoVmFsaWRhdGlvbiwKICAgIHJlcG9ydEhlYWRlcjogcmVwb3J0SGVhZGVyCiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdGl0bGU6IHRoaXMuJHQoInJlcG9ydFJvbGVzIiksCiAgICAgIGxvYWRlcjogdHJ1ZSwKICAgICAgc2VsZWN0TG9hZEl0ZW1Mb2FkZXI6IG51bGwsCiAgICAgIHNlbGVjdExvYWRJdGVtVGltZU91dDogbnVsbCwKICAgICAgcGFyYW1zOiB7CiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBsaW1pdDogMjAsCiAgICAgICAgICBwYWdlOiAwCiAgICAgICAgfSwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIGRvY1RhYmxlSWQ6ICIiLAogICAgICAgIGRhdGVUeXBlSWQ6ICIiCiAgICAgIH0sCiAgICAgIHRhYmxlTGlzdFBhcmFtczogewogICAgICAgIGl0ZW1zUGVyUGFnZTogMjAsCiAgICAgICAgcGFnZTogMAogICAgICB9LAogICAgICB0YWJsZUxpc3Q6IFtdLAogICAgICB0YWJsZUxpc3RMZW5ndGg6IDAsCiAgICAgIGRvY1RhYmxlRmllbGRzT3JpZ2luYWw6IFtdLAogICAgICBkb2NUYWJsZUZpZWxkc1NlcmlhbGl6ZWQ6IFtdLAogICAgICBvd25Eb2NUYWJsZUxpc3Q6IFtdLAogICAgICBkYXRlVHlwZUxpc3Q6IFtdLAogICAgICBkYXRlVHlwZUxpc3RQYXlsb2FkOiB7CiAgICAgICAgcGFnZTogMCwKICAgICAgICBpdGVtc1BlclBhZ2U6IDEwMAogICAgICB9LAogICAgICBzZWxlY3RPcHRpb25zQnlSZWZlcmVuY2VVcmw6IHt9LAogICAgICBzZWxlY3RlZERvY1JlcG9ydHM6IHsKICAgICAgICBpbmRleFNldDogbmV3IFNldCgpLAogICAgICAgIGRvY1RhYmxlSWQ6IGZhbHNlLAogICAgICAgIGRvY1RhYmxlOiBudWxsLAogICAgICAgIGRvY1JlcG9ydHM6IHt9CiAgICAgIH0sCiAgICAgIGNvbGxlY3RlZFJlcG9ydEZvclRhYmxlUmVwb3J0OiBbXSwKICAgICAgY29sbGVjdGluZ1R5cGU6ICdBU1NFTUJMRScsCiAgICAgIGNvbGxlY3Rpb25BdmdJZ25vcmVaZXJvOiBmYWxzZSwKICAgICAgY29sbGVjdGluZ0dyb3VwQ29sdW1uSWQ6IG51bGwsCiAgICAgIGNvbGxlY3RpbmdUeXBlTGlzdDogW3sKICAgICAgICB2YWx1ZTogIkFTU0VNQkxFIiwKICAgICAgICBuYW1lOiAiWWlnJ2lzaCIKICAgICAgfSwgewogICAgICAgIHZhbHVlOiAiQ09MTEVDVF9TVU0iLAogICAgICAgIG5hbWU6ICJZaWcnaW5kaW5pIHlpZydpc2ggKFNVTSkiCiAgICAgIH0sIHsKICAgICAgICB2YWx1ZTogIkNPTExFQ1RfQVZHIiwKICAgICAgICBuYW1lOiAiTydydGFjaGEgcWl5bWF0IHlpZydpc2ggKEFWRykiCiAgICAgIH1dLAogICAgICBzYXZlRGF0YTogewogICAgICAgIHJlcG9ydEluZm9Gb3JHYXRoZXI6IHsKICAgICAgICAgIG5hbWVVejogJycsCiAgICAgICAgICBuYW1lTHQ6ICcnLAogICAgICAgICAgbmFtZVJ1OiAnJywKICAgICAgICAgIGRhdGU6ICcnCiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgcmV0dXJuIF90aGlzLmdldE93bkRvY1RhYmxlTGlzdCgpOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBfdGhpcy5sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlKTsKICAgIH0pKSgpOwogIH0sCiAgbWV0aG9kczogewogICAgZ2V0T3duRG9jVGFibGVMaXN0OiBmdW5jdGlvbiBnZXRPd25Eb2NUYWJsZUxpc3QoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwogICAgICByZXBvcnRTZXJ2aWNlLmdldE93blRhYmxlKHRoaXMucGFyYW1zKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgX3RoaXMyLm93bkRvY1RhYmxlTGlzdCA9IHJlc3BvbnNlLmRhdGEubGlzdDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGdldERhdGVUeXBlTGlzdDogZnVuY3Rpb24gZ2V0RGF0ZVR5cGVMaXN0KGRhdGVUeXBlSWQpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CiAgICAgIHJlcG9ydFNlcnZpY2UuZ2V0TGlzdEJ5UGFyZW50SWQoZGF0ZVR5cGVJZCwgdGhpcy5kYXRlVHlwZUxpc3RQYXlsb2FkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgX3RoaXMzLmRhdGVUeXBlTGlzdCA9IHJlc3BvbnNlLmRhdGEubGlzdDsKICAgICAgICB9CiAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMy5sb2FkZXIgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgaGFuZGxlU2VhcmNoOiBmdW5jdGlvbiBoYW5kbGVTZWFyY2goKSB7CiAgICAgIHZhciBfYXJndW1lbnRzID0gYXJndW1lbnRzLAogICAgICAgIF90aGlzNCA9IHRoaXM7CiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBjbGVhclNlbGVjdGVkOwogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBjbGVhclNlbGVjdGVkID0gX2FyZ3VtZW50cy5sZW5ndGggPiAwICYmIF9hcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmd1bWVudHNbMF0gOiB0cnVlOwogICAgICAgICAgICAgIGlmIChjbGVhclNlbGVjdGVkKSB7CiAgICAgICAgICAgICAgICBfdGhpczQuc2VsZWN0ZWREb2NSZXBvcnRzLmRvY1RhYmxlSWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF90aGlzNC5zZWxlY3RlZERvY1JlcG9ydHMuaW5kZXhTZXQgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXM0LmdldFRhYmxlTGlzdCgpOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBoYW5kbGVWYWxpZGF0ZUZvckNvbGxlY3Rpbmc6IGZ1bmN0aW9uIGhhbmRsZVZhbGlkYXRlRm9yQ29sbGVjdGluZygpIHsKICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkRG9jUmVwb3J0cy5kb2NUYWJsZUlkIHx8IHRoaXMuc2VsZWN0ZWREb2NSZXBvcnRzLmluZGV4U2V0LnNpemUgPCAyKSB7CiAgICAgICAgdGhpcy4kdG9hc3QodGhpcy4kdCgic3VibW9kdWxlcy5yZXBvcnRzLnNlbGVjdF9taW5pbXVtX3R3b19yZXBvcnQiKSwgewogICAgICAgICAgdHlwZTogIndhcm5pbmciCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIGhhbmRsZUNvbGxlY3Q6IGZ1bmN0aW9uIGhhbmRsZUNvbGxlY3QoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX3RoaXM1LmxvYWRlciA9IHRydWU7CiAgICAgICAgICAgICAgX3RoaXM1LmNvbGxlY3RlZFJlcG9ydEZvclRhYmxlUmVwb3J0ID0gW107CiAgICAgICAgICAgICAgX3RoaXM1LmRvY1RhYmxlRmllbGRzT3JpZ2luYWwgPSBbXTsKICAgICAgICAgICAgICBfdGhpczUuZG9jVGFibGVGaWVsZHNTZXJpYWxpemVkID0gW107CiAgICAgICAgICAgICAgaWYgKF90aGlzNS5oYW5kbGVWYWxpZGF0ZUZvckNvbGxlY3RpbmcoKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF90aGlzNS5sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIik7CiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlcG9ydFNlcnZpY2UuZ2V0QnlJZFRhYmxlKF90aGlzNS5zZWxlY3RlZERvY1JlcG9ydHMuZG9jVGFibGVJZCkudGhlbiggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuY29sdW1ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM1LmRvY1RhYmxlRmllbGRzT3JpZ2luYWwgPSByZXNwb25zZS5kYXRhLmNvbHVtbnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM1LmRlc2VyaWFsaXplRG9jVGFibGVGaWVsZHMoX3RoaXM1LmRvY1RhYmxlRmllbGRzT3JpZ2luYWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNS5zZWxlY3RlZERvY1JlcG9ydHMuZG9jVGFibGUgPSByZXNwb25zZS5kYXRhLnRhYmxlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzNS4kYnZNb2RhbC5zaG93KCdtb2RhbCcpOwogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczUuaGFuZGxlQ29sbGVjdFZpZXcoKTsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM1LmxvYWRlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0oKSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgX3RoaXM1LmxvYWRlciA9IGZhbHNlOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBkZXNlcmlhbGl6ZURvY1RhYmxlRmllbGRzOiBmdW5jdGlvbiBkZXNlcmlhbGl6ZURvY1RhYmxlRmllbGRzKGxpc3QpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CiAgICAgIHZhciBjbGVhciA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdHJ1ZTsKICAgICAgaWYgKGNsZWFyKSB7CiAgICAgICAgdGhpcy5kb2NUYWJsZUZpZWxkc1NlcmlhbGl6ZWQgPSBbXTsKICAgICAgfQogICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgICAgICBfdGhpczYuZGVzZXJpYWxpemVEb2NUYWJsZUZpZWxkcyhlLmNoaWxkcmVuLCBmYWxzZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzNi5kb2NUYWJsZUZpZWxkc1NlcmlhbGl6ZWQucHVzaChlKTsKICAgICAgICAgIGlmIChlLnR5cGVDb2RlID09PSAnU0VMRUNUJykgewogICAgICAgICAgICBfdGhpczYuc2VsZWN0T3B0aW9uc0J5UmVmZXJlbmNlVXJsW2UuaWRdID0gW107CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVDb2xsZWN0VmlldzogZnVuY3Rpb24gaGFuZGxlQ29sbGVjdFZpZXcoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaWYgKF90aGlzNy5oYW5kbGVWYWxpZGF0ZUZvckNvbGxlY3RpbmcoKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iKTsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIF90aGlzNy5sb2FkZXIgPSB0cnVlOwogICAgICAgICAgICAgIF90aGlzNy5zZWxlY3RlZERvY1JlcG9ydHMuZG9jUmVwb3J0cyA9IHt9OwogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNjsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXM3LnNlbGVjdGVkRG9jUmVwb3J0cy5pbmRleFNldC5mb3JFYWNoKGZ1bmN0aW9uIChkb2NSZXBvcnRJZCkgewogICAgICAgICAgICAgICAgX3RoaXM3LnNlbGVjdGVkRG9jUmVwb3J0cy5kb2NSZXBvcnRzW2RvY1JlcG9ydElkXSA9IHt9OwogICAgICAgICAgICAgICAgcmVwb3J0U2VydmljZS5nZXRSZXBvcnRCeUlkKGRvY1JlcG9ydElkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubWFwKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzNy5zZWxlY3RlZERvY1JlcG9ydHMuZG9jUmVwb3J0c1tkb2NSZXBvcnRJZF1bdmFsdWUucm93SWRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM3LnNlbGVjdGVkRG9jUmVwb3J0cy5kb2NSZXBvcnRzW2RvY1JlcG9ydElkXVt2YWx1ZS5yb3dJZF0gPSB7fTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIF90aGlzNy5zZWxlY3RlZERvY1JlcG9ydHMuZG9jUmVwb3J0c1tkb2NSZXBvcnRJZF1bdmFsdWUucm93SWRdW3ZhbHVlLmNvbHVtbklkXSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1KTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgaGFuZGxlQ29sbGVjdGVkUmVwb3J0RHJhdzogZnVuY3Rpb24gaGFuZGxlQ29sbGVjdGVkUmVwb3J0RHJhdygpIHsKICAgICAgdGhpcy5jb2xsZWN0ZWRSZXBvcnRGb3JUYWJsZVJlcG9ydCA9IFtdOwogICAgICBzd2l0Y2ggKHRoaXMuY29sbGVjdGluZ1R5cGUpIHsKICAgICAgICBjYXNlICdBU1NFTUJMRSc6CiAgICAgICAgICB0aGlzLmhhbmRsZUNvbGxlY3RlZFJlcG9ydERyYXdBc3NlbWJsZSgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnQ09MTEVDVF9TVU0nOgogICAgICAgICAgdGhpcy5oYW5kbGVDb2xsZWN0ZWRSZXBvcnREcmF3Q29sbGVjdFN1bSgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnQ09MTEVDVF9BVkcnOgogICAgICAgICAgdGhpcy5oYW5kbGVDb2xsZWN0ZWRSZXBvcnREcmF3Q29sbGVjdEF2ZygpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVDb2xsZWN0ZWRSZXBvcnREcmF3QXNzZW1ibGU6IGZ1bmN0aW9uIGhhbmRsZUNvbGxlY3RlZFJlcG9ydERyYXdBc3NlbWJsZSgpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CiAgICAgIHZhciBzZXF1ZW5jZSA9IDE7CiAgICAgIHRoaXMuc2VsZWN0ZWREb2NSZXBvcnRzLmluZGV4U2V0LmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgdmFyIHJlcG9ydHMgPSBfdGhpczguc2VsZWN0ZWREb2NSZXBvcnRzLmRvY1JlcG9ydHNbdmFsdWVdOwogICAgICAgIHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkgewogICAgICAgICAgdmFyIHJlcG9ydFJvdyA9IHJlcG9ydHNbcmVwb3J0Um93SW5kZXhdOwogICAgICAgICAgdmFyIHJlcG9ydFJvd0RhdGEgPSBKU09OLnBhcnNlKCdbXScpOwogICAgICAgICAgX3RoaXM4LmRvY1RhYmxlRmllbGRzU2VyaWFsaXplZC5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICBpZiAocmVwb3J0Um93W2ZpZWxkLmlkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgcmVwb3J0Um93RGF0YS5wdXNoKHJlcG9ydFJvd1tmaWVsZC5pZF0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlQ29kZSA9PT0gJ1NFUVVFTkNFJykgewogICAgICAgICAgICAgICAgcmVwb3J0Um93RGF0YS5wdXNoKHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHNlcXVlbmNlLAogICAgICAgICAgICAgICAgICB0eXBlQ29kZTogZmllbGQudHlwZUNvZGUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2VxdWVuY2UrKzsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVwb3J0Um93RGF0YS5wdXNoKHt9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXM4LmNvbGxlY3RlZFJlcG9ydEZvclRhYmxlUmVwb3J0LnB1c2gocmVwb3J0Um93RGF0YSk7CiAgICAgICAgfTsKICAgICAgICBmb3IgKHZhciByZXBvcnRSb3dJbmRleCBpbiByZXBvcnRzKSB7CiAgICAgICAgICBfbG9vcCgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgaGFuZGxlQ29sbGVjdGVkUmVwb3J0RHJhd0NvbGxlY3RTdW06IGZ1bmN0aW9uIGhhbmRsZUNvbGxlY3RlZFJlcG9ydERyYXdDb2xsZWN0U3VtKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKICAgICAgdmFyIHNlcXVlbmNlID0gMTsKICAgICAgdGhpcy5zZWxlY3RlZERvY1JlcG9ydHMuaW5kZXhTZXQuZm9yRWFjaChmdW5jdGlvbiAoZG9jUmVwb3J0SWQpIHsKICAgICAgICB2YXIgcmVwb3J0RGF0YSA9IFtdOwogICAgICAgIHZhciBzdW1CaWdJbnRlZ2VyQ291bnQgPSB7fTsKICAgICAgICB2YXIgcmVwb3J0cyA9IF90aGlzOS5zZWxlY3RlZERvY1JlcG9ydHMuZG9jUmVwb3J0c1tkb2NSZXBvcnRJZF07CiAgICAgICAgdmFyIF9sb29wMiA9IGZ1bmN0aW9uIF9sb29wMigpIHsKICAgICAgICAgIHZhciByZXBvcnQgPSByZXBvcnRzW3JlcG9ydFJvd0luZGV4XTsKICAgICAgICAgIF90aGlzOS5kb2NUYWJsZUZpZWxkc1NlcmlhbGl6ZWQuZm9yRWFjaChmdW5jdGlvbiAoZG9jVGFibGVGaWVsZCwgZG9jVGFibGVGaWVsZEluZGV4KSB7CiAgICAgICAgICAgIHZhciBfcmVwb3J0RGF0YSRkb2NUYWJsZUY7CiAgICAgICAgICAgIHZhciByZXBvcnRSb3dGaWVsZCA9IHJlcG9ydFtkb2NUYWJsZUZpZWxkLmlkXTsKICAgICAgICAgICAgaWYgKGRvY1RhYmxlRmllbGQudHlwZUNvZGUgPT09ICdTRVFVRU5DRScgJiYgdHlwZW9mIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0gPSB7CiAgICAgICAgICAgICAgICB2YWx1ZTogc2VxdWVuY2UsCiAgICAgICAgICAgICAgICB0eXBlQ29kZTogIlNFUVVFTkNFIgogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdID0gcmVwb3J0Um93RmllbGQgJiYgISgoX3JlcG9ydERhdGEkZG9jVGFibGVGID0gcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdKSAhPT0gbnVsbCAmJiBfcmVwb3J0RGF0YSRkb2NUYWJsZUYgIT09IHZvaWQgMCAmJiBfcmVwb3J0RGF0YSRkb2NUYWJsZUYuaWQpID8gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXBvcnRSb3dGaWVsZCkpIDogcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdIHx8IHt9OwogICAgICAgICAgICBpZiAoZG9jVGFibGVGaWVsZC50eXBlQ29kZSA9PT0gJ0JJR0RFQ0lNQUwnKSB7CiAgICAgICAgICAgICAgdmFyIF9yZXBvcnRSb3dGaWVsZCR2YWx1ZSwgX3JlcG9ydERhdGEkZG9jVGFibGVGMjsKICAgICAgICAgICAgICB2YXIgdmFsdWVCaWdEZWNpbWFsID0gKF9yZXBvcnRSb3dGaWVsZCR2YWx1ZSA9IHJlcG9ydFJvd0ZpZWxkID09PSBudWxsIHx8IHJlcG9ydFJvd0ZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXBvcnRSb3dGaWVsZC52YWx1ZUJpZ0RlY2ltYWwpICE9PSBudWxsICYmIF9yZXBvcnRSb3dGaWVsZCR2YWx1ZSAhPT0gdm9pZCAwID8gX3JlcG9ydFJvd0ZpZWxkJHZhbHVlIDogMDsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHN1bUJpZ0ludGVnZXJDb3VudFtkb2NUYWJsZUZpZWxkLmlkXSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgIHN1bUJpZ0ludGVnZXJDb3VudFtkb2NUYWJsZUZpZWxkLmlkXSA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlQmlnRGVjaW1hbCA9PT0gJ3VuZGVmaW5lZCcgfHwgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlQmlnRGVjaW1hbCA9PT0gbnVsbCB8fCByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udmFsdWVCaWdEZWNpbWFsID09PSAnJykgewogICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlQmlnRGVjaW1hbCA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh2YWx1ZUJpZ0RlY2ltYWwgJiYgKHZhbHVlQmlnRGVjaW1hbCA+IDAgfHwgdmFsdWVCaWdEZWNpbWFsIDwgMCkpIHsKICAgICAgICAgICAgICAgIHN1bUJpZ0ludGVnZXJDb3VudFtkb2NUYWJsZUZpZWxkLmlkXSsrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodmFsdWVCaWdEZWNpbWFsICYmIChyZXBvcnRSb3dGaWVsZCA9PT0gbnVsbCB8fCByZXBvcnRSb3dGaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVwb3J0Um93RmllbGQuaWQpICE9PSAoKF9yZXBvcnREYXRhJGRvY1RhYmxlRjIgPSByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0pID09PSBudWxsIHx8IF9yZXBvcnREYXRhJGRvY1RhYmxlRjIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yZXBvcnREYXRhJGRvY1RhYmxlRjIuaWQpKSB7CiAgICAgICAgICAgICAgICB2YXIgX3JlcG9ydERhdGEkZG9jVGFibGVGMzsKICAgICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS52YWx1ZUJpZ0RlY2ltYWwgKz0gdmFsdWVCaWdEZWNpbWFsOwogICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlID0gKF9yZXBvcnREYXRhJGRvY1RhYmxlRjMgPSByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udmFsdWVCaWdEZWNpbWFsKSA9PT0gbnVsbCB8fCBfcmVwb3J0RGF0YSRkb2NUYWJsZUYzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcmVwb3J0RGF0YSRkb2NUYWJsZUYzLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGRvY1RhYmxlRmllbGQudHlwZUNvZGUgPT09ICdTVFJJTkcnIHx8IGRvY1RhYmxlRmllbGQudHlwZUNvZGUgPT09ICdEQVRFJyB8fCBkb2NUYWJsZUZpZWxkLnR5cGVDb2RlID09PSAnWUVBUicgfHwgZG9jVGFibGVGaWVsZC50eXBlQ29kZSA9PT0gJ0JPT0xFQU4nKSB7CiAgICAgICAgICAgICAgdmFyIF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTIsIF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTMsIF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTQsIF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTU7CiAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlICs9ICIsICIgKyAoKF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTIgPSByZXBvcnRSb3dGaWVsZC52YWx1ZSkgIT09IG51bGwgJiYgX3JlcG9ydFJvd0ZpZWxkJHZhbHVlMiAhPT0gdm9pZCAwID8gX3JlcG9ydFJvd0ZpZWxkJHZhbHVlMiA6ICcnKTsKICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udmFsdWVEYXRlICs9ICIsICIgKyAoKF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTMgPSByZXBvcnRSb3dGaWVsZC52YWx1ZURhdGUpICE9PSBudWxsICYmIF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTMgIT09IHZvaWQgMCA/IF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTMgOiAnJyk7CiAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlU3RyaW5nICs9ICIsICIgKyAoKF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTQgPSByZXBvcnRSb3dGaWVsZC52YWx1ZVN0cmluZykgIT09IG51bGwgJiYgX3JlcG9ydFJvd0ZpZWxkJHZhbHVlNCAhPT0gdm9pZCAwID8gX3JlcG9ydFJvd0ZpZWxkJHZhbHVlNCA6ICcnKTsKICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udmFsdWVCb29sZWFuICs9ICIsICIgKyAoKF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTUgPSByZXBvcnRSb3dGaWVsZC52YWx1ZUJvb2xlYW4pICE9PSBudWxsICYmIF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTUgIT09IHZvaWQgMCA/IF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTUgOiAnJyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jVGFibGVGaWVsZC50eXBlQ29kZSA9PT0gJ1NFTEVDVCcpIHsKICAgICAgICAgICAgICB2YXIgX3JlcG9ydERhdGEkZG9jVGFibGVGNCwgX3JlcG9ydERhdGEkZG9jVGFibGVGNSwgX3JlcG9ydERhdGEkZG9jVGFibGVGNjsKICAgICAgICAgICAgICBpZiAoIXJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XSkgewogICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXBvcnRSb3dGaWVsZCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0uaWQgPSByZXBvcnRSb3dGaWVsZC5pZDsKICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0ucm93SWQgPSByZXBvcnRSb3dGaWVsZC5yb3dJZDsKICAgICAgICAgICAgICAvLyByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udHlwZUNvZGUgPSAnU1RSSU5HJzsKICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0uY29sdW1uSWQgPSByZXBvcnRSb3dGaWVsZC5jb2x1bW5JZDsKICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0uZG9jUmVwb3J0SWQgPSByZXBvcnRSb3dGaWVsZC5kb2NSZXBvcnRJZDsKICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0uc2VsZWN0VmFsdWVJZCA9IG51bGw7CiAgICAgICAgICAgICAgaWYgKCgoX3JlcG9ydERhdGEkZG9jVGFibGVGNCA9IHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XSkgPT09IG51bGwgfHwgX3JlcG9ydERhdGEkZG9jVGFibGVGNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9yZXBvcnREYXRhJGRvY1RhYmxlRjUgPSBfcmVwb3J0RGF0YSRkb2NUYWJsZUY0LnZhbHVlU3RyaW5nKSA9PT0gbnVsbCB8fCBfcmVwb3J0RGF0YSRkb2NUYWJsZUY1ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcmVwb3J0RGF0YSRkb2NUYWJsZUY1LmluZGV4T2YocmVwb3J0Um93RmllbGQuc2VsZWN0VmFsdWVOYW1lVXopKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIGlmIChyZXBvcnRSb3dGaWVsZCAhPT0gbnVsbCAmJiByZXBvcnRSb3dGaWVsZCAhPT0gdm9pZCAwICYmIHJlcG9ydFJvd0ZpZWxkLnNlbGVjdFZhbHVlTmFtZVV6KSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVwb3J0Um93RmllbGQkc2VsZWMsIF9yZXBvcnRSb3dGaWVsZCRzZWxlYzIsIF9yZXBvcnRSb3dGaWVsZCRzZWxlYzM7CiAgICAgICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS52YWx1ZVN0cmluZyArPSAoKF9yZXBvcnRSb3dGaWVsZCRzZWxlYyA9IHJlcG9ydFJvd0ZpZWxkID09PSBudWxsIHx8IHJlcG9ydFJvd0ZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVVeikgIT09IG51bGwgJiYgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjICE9PSB2b2lkIDAgPyBfcmVwb3J0Um93RmllbGQkc2VsZWMgOiAnJykgKyAiLCAiOwogICAgICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udmFsdWUgKz0gKChfcmVwb3J0Um93RmllbGQkc2VsZWMyID0gcmVwb3J0Um93RmllbGQgPT09IG51bGwgfHwgcmVwb3J0Um93RmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlcG9ydFJvd0ZpZWxkLnNlbGVjdFZhbHVlTmFtZVV6KSAhPT0gbnVsbCAmJiBfcmVwb3J0Um93RmllbGQkc2VsZWMyICE9PSB2b2lkIDAgPyBfcmVwb3J0Um93RmllbGQkc2VsZWMyIDogJycpICsgIiwgIjsKICAgICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnNlbGVjdFZhbHVlTmFtZVV6ICs9ICgoX3JlcG9ydFJvd0ZpZWxkJHNlbGVjMyA9IHJlcG9ydFJvd0ZpZWxkID09PSBudWxsIHx8IHJlcG9ydFJvd0ZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVVeikgIT09IG51bGwgJiYgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjMyAhPT0gdm9pZCAwID8gX3JlcG9ydFJvd0ZpZWxkJHNlbGVjMyA6ICcnKSArICIsICI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocmVwb3J0Um93RmllbGQgIT09IG51bGwgJiYgcmVwb3J0Um93RmllbGQgIT09IHZvaWQgMCAmJiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVFbikgewogICAgICAgICAgICAgICAgICB2YXIgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNDsKICAgICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnNlbGVjdFZhbHVlTmFtZUVuICs9ICgoX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNCA9IHJlcG9ydFJvd0ZpZWxkID09PSBudWxsIHx8IHJlcG9ydFJvd0ZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVFbikgIT09IG51bGwgJiYgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNCAhPT0gdm9pZCAwID8gX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNCA6ICcnKSArICIsICI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocmVwb3J0Um93RmllbGQgIT09IG51bGwgJiYgcmVwb3J0Um93RmllbGQgIT09IHZvaWQgMCAmJiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVMdCkgewogICAgICAgICAgICAgICAgICB2YXIgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNTsKICAgICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnNlbGVjdFZhbHVlTmFtZUx0ICs9ICgoX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNSA9IHJlcG9ydFJvd0ZpZWxkID09PSBudWxsIHx8IHJlcG9ydFJvd0ZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVMdCkgIT09IG51bGwgJiYgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNSAhPT0gdm9pZCAwID8gX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNSA6ICcnKSArICIsICI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocmVwb3J0Um93RmllbGQgIT09IG51bGwgJiYgcmVwb3J0Um93RmllbGQgIT09IHZvaWQgMCAmJiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVSdSkgewogICAgICAgICAgICAgICAgICB2YXIgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNjsKICAgICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnNlbGVjdFZhbHVlTmFtZVJ1ICs9ICgoX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNiA9IHJlcG9ydFJvd0ZpZWxkID09PSBudWxsIHx8IHJlcG9ydFJvd0ZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVSdSkgIT09IG51bGwgJiYgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNiAhPT0gdm9pZCAwID8gX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNiA6ICcnKSArICIsICI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmICgoKF9yZXBvcnREYXRhJGRvY1RhYmxlRjYgPSByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0pID09PSBudWxsIHx8IF9yZXBvcnREYXRhJGRvY1RhYmxlRjYgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yZXBvcnREYXRhJGRvY1RhYmxlRjYudmFsdWVTdHJpbmcpID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udmFsdWVTdHJpbmcgPSAnJzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgZm9yICh2YXIgcmVwb3J0Um93SW5kZXggaW4gcmVwb3J0cykgewogICAgICAgICAgX2xvb3AyKCk7CiAgICAgICAgfQogICAgICAgIF90aGlzOS5jb2xsZWN0ZWRSZXBvcnRGb3JUYWJsZVJlcG9ydC5wdXNoKHJlcG9ydERhdGEpOwogICAgICAgIHNlcXVlbmNlKys7CiAgICAgIH0pOwogICAgfSwKICAgIGhhbmRsZUNvbGxlY3RlZFJlcG9ydERyYXdDb2xsZWN0QXZnOiBmdW5jdGlvbiBoYW5kbGVDb2xsZWN0ZWRSZXBvcnREcmF3Q29sbGVjdEF2ZygpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwogICAgICB2YXIgc2VxdWVuY2UgPSAxOwogICAgICB0aGlzLnNlbGVjdGVkRG9jUmVwb3J0cy5pbmRleFNldC5mb3JFYWNoKGZ1bmN0aW9uIChkb2NSZXBvcnRJZCkgewogICAgICAgIHZhciByZXBvcnREYXRhID0gW107CiAgICAgICAgdmFyIHN1bUJpZ0ludGVnZXJDb3VudCA9IHt9OwogICAgICAgIHZhciByZXBvcnRzID0gX3RoaXMxMC5zZWxlY3RlZERvY1JlcG9ydHMuZG9jUmVwb3J0c1tkb2NSZXBvcnRJZF07CiAgICAgICAgdmFyIF9sb29wMyA9IGZ1bmN0aW9uIF9sb29wMygpIHsKICAgICAgICAgIHZhciByZXBvcnQgPSByZXBvcnRzW3JlcG9ydFJvd0luZGV4XTsKICAgICAgICAgIF90aGlzMTAuZG9jVGFibGVGaWVsZHNTZXJpYWxpemVkLmZvckVhY2goZnVuY3Rpb24gKGRvY1RhYmxlRmllbGQsIGRvY1RhYmxlRmllbGRJbmRleCkgewogICAgICAgICAgICB2YXIgX3JlcG9ydERhdGEkZG9jVGFibGVGNzsKICAgICAgICAgICAgdmFyIHJlcG9ydFJvd0ZpZWxkID0gcmVwb3J0W2RvY1RhYmxlRmllbGQuaWRdOwogICAgICAgICAgICBpZiAoZG9jVGFibGVGaWVsZC50eXBlQ29kZSA9PT0gJ1NFUVVFTkNFJyAmJiB0eXBlb2YgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XSA9IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBzZXF1ZW5jZSwKICAgICAgICAgICAgICAgIHR5cGVDb2RlOiAiU0VRVUVOQ0UiCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0gPSByZXBvcnRSb3dGaWVsZCAmJiAhKChfcmVwb3J0RGF0YSRkb2NUYWJsZUY3ID0gcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdKSAhPT0gbnVsbCAmJiBfcmVwb3J0RGF0YSRkb2NUYWJsZUY3ICE9PSB2b2lkIDAgJiYgX3JlcG9ydERhdGEkZG9jVGFibGVGNy5pZCkgPyBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlcG9ydFJvd0ZpZWxkKSkgOiByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0gfHwge307CiAgICAgICAgICAgIGlmIChkb2NUYWJsZUZpZWxkLnR5cGVDb2RlID09PSAnQklHREVDSU1BTCcpIHsKICAgICAgICAgICAgICB2YXIgX3JlcG9ydFJvd0ZpZWxkJHZhbHVlNiwgX3JlcG9ydERhdGEkZG9jVGFibGVGODsKICAgICAgICAgICAgICB2YXIgdmFsdWVCaWdEZWNpbWFsID0gKF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTYgPSByZXBvcnRSb3dGaWVsZCA9PT0gbnVsbCB8fCByZXBvcnRSb3dGaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVwb3J0Um93RmllbGQudmFsdWVCaWdEZWNpbWFsKSAhPT0gbnVsbCAmJiBfcmVwb3J0Um93RmllbGQkdmFsdWU2ICE9PSB2b2lkIDAgPyBfcmVwb3J0Um93RmllbGQkdmFsdWU2IDogMDsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHN1bUJpZ0ludGVnZXJDb3VudFtkb2NUYWJsZUZpZWxkLmlkXSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgIHN1bUJpZ0ludGVnZXJDb3VudFtkb2NUYWJsZUZpZWxkLmlkXSA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlQmlnRGVjaW1hbCA9PT0gJ3VuZGVmaW5lZCcgfHwgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlQmlnRGVjaW1hbCA9PT0gbnVsbCB8fCByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udmFsdWVCaWdEZWNpbWFsID09PSAnJykgewogICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlQmlnRGVjaW1hbCA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChfdGhpczEwLmNvbGxlY3Rpb25BdmdJZ25vcmVaZXJvKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWVCaWdEZWNpbWFsICYmICh2YWx1ZUJpZ0RlY2ltYWwgPiAwIHx8IHZhbHVlQmlnRGVjaW1hbCA8IDApKSB7CiAgICAgICAgICAgICAgICAgIHN1bUJpZ0ludGVnZXJDb3VudFtkb2NUYWJsZUZpZWxkLmlkXSsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdW1CaWdJbnRlZ2VyQ291bnRbZG9jVGFibGVGaWVsZC5pZF0rKzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHZhbHVlQmlnRGVjaW1hbCAmJiAocmVwb3J0Um93RmllbGQgPT09IG51bGwgfHwgcmVwb3J0Um93RmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlcG9ydFJvd0ZpZWxkLmlkKSAhPT0gKChfcmVwb3J0RGF0YSRkb2NUYWJsZUY4ID0gcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdKSA9PT0gbnVsbCB8fCBfcmVwb3J0RGF0YSRkb2NUYWJsZUY4ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcmVwb3J0RGF0YSRkb2NUYWJsZUY4LmlkKSkgewogICAgICAgICAgICAgICAgdmFyIF9yZXBvcnREYXRhJGRvY1RhYmxlRjk7CiAgICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udmFsdWVCaWdEZWNpbWFsICs9IHZhbHVlQmlnRGVjaW1hbDsKICAgICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS52YWx1ZSA9IChfcmVwb3J0RGF0YSRkb2NUYWJsZUY5ID0gcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlQmlnRGVjaW1hbCkgPT09IG51bGwgfHwgX3JlcG9ydERhdGEkZG9jVGFibGVGOSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3JlcG9ydERhdGEkZG9jVGFibGVGOS50b1N0cmluZygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChkb2NUYWJsZUZpZWxkLnR5cGVDb2RlID09PSAnU1RSSU5HJyB8fCBkb2NUYWJsZUZpZWxkLnR5cGVDb2RlID09PSAnREFURScgfHwgZG9jVGFibGVGaWVsZC50eXBlQ29kZSA9PT0gJ1lFQVInIHx8IGRvY1RhYmxlRmllbGQudHlwZUNvZGUgPT09ICdCT09MRUFOJykgewogICAgICAgICAgICAgIHZhciBfcmVwb3J0Um93RmllbGQkdmFsdWU3LCBfcmVwb3J0Um93RmllbGQkdmFsdWU4LCBfcmVwb3J0Um93RmllbGQkdmFsdWU5LCBfcmVwb3J0Um93RmllbGQkdmFsdWUxMDsKICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udmFsdWUgKz0gIiwgIiArICgoX3JlcG9ydFJvd0ZpZWxkJHZhbHVlNyA9IHJlcG9ydFJvd0ZpZWxkLnZhbHVlKSAhPT0gbnVsbCAmJiBfcmVwb3J0Um93RmllbGQkdmFsdWU3ICE9PSB2b2lkIDAgPyBfcmVwb3J0Um93RmllbGQkdmFsdWU3IDogJycpOwogICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS52YWx1ZURhdGUgKz0gIiwgIiArICgoX3JlcG9ydFJvd0ZpZWxkJHZhbHVlOCA9IHJlcG9ydFJvd0ZpZWxkLnZhbHVlRGF0ZSkgIT09IG51bGwgJiYgX3JlcG9ydFJvd0ZpZWxkJHZhbHVlOCAhPT0gdm9pZCAwID8gX3JlcG9ydFJvd0ZpZWxkJHZhbHVlOCA6ICcnKTsKICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0udmFsdWVTdHJpbmcgKz0gIiwgIiArICgoX3JlcG9ydFJvd0ZpZWxkJHZhbHVlOSA9IHJlcG9ydFJvd0ZpZWxkLnZhbHVlU3RyaW5nKSAhPT0gbnVsbCAmJiBfcmVwb3J0Um93RmllbGQkdmFsdWU5ICE9PSB2b2lkIDAgPyBfcmVwb3J0Um93RmllbGQkdmFsdWU5IDogJycpOwogICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS52YWx1ZUJvb2xlYW4gKz0gIiwgIiArICgoX3JlcG9ydFJvd0ZpZWxkJHZhbHVlMTAgPSByZXBvcnRSb3dGaWVsZC52YWx1ZUJvb2xlYW4pICE9PSBudWxsICYmIF9yZXBvcnRSb3dGaWVsZCR2YWx1ZTEwICE9PSB2b2lkIDAgPyBfcmVwb3J0Um93RmllbGQkdmFsdWUxMCA6ICcnKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChkb2NUYWJsZUZpZWxkLnR5cGVDb2RlID09PSAnU0VMRUNUJykgewogICAgICAgICAgICAgIHZhciBfcmVwb3J0RGF0YSRkb2NUYWJsZUYxMCwgX3JlcG9ydERhdGEkZG9jVGFibGVGMTEsIF9yZXBvcnREYXRhJGRvY1RhYmxlRjEyOwogICAgICAgICAgICAgIGlmICghcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdKSB7CiAgICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlcG9ydFJvd0ZpZWxkKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS5pZCA9IHJlcG9ydFJvd0ZpZWxkLmlkOwogICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS5yb3dJZCA9IHJlcG9ydFJvd0ZpZWxkLnJvd0lkOwogICAgICAgICAgICAgIC8vIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS50eXBlQ29kZSA9ICdTVFJJTkcnOwogICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS5jb2x1bW5JZCA9IHJlcG9ydFJvd0ZpZWxkLmNvbHVtbklkOwogICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS5kb2NSZXBvcnRJZCA9IHJlcG9ydFJvd0ZpZWxkLmRvY1JlcG9ydElkOwogICAgICAgICAgICAgIGlmICgoKF9yZXBvcnREYXRhJGRvY1RhYmxlRjEwID0gcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdKSA9PT0gbnVsbCB8fCBfcmVwb3J0RGF0YSRkb2NUYWJsZUYxMCA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9yZXBvcnREYXRhJGRvY1RhYmxlRjExID0gX3JlcG9ydERhdGEkZG9jVGFibGVGMTAudmFsdWVTdHJpbmcpID09PSBudWxsIHx8IF9yZXBvcnREYXRhJGRvY1RhYmxlRjExID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcmVwb3J0RGF0YSRkb2NUYWJsZUYxMS5pbmRleE9mKHJlcG9ydFJvd0ZpZWxkLnNlbGVjdFZhbHVlTmFtZVV6KSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICBpZiAocmVwb3J0Um93RmllbGQgIT09IG51bGwgJiYgcmVwb3J0Um93RmllbGQgIT09IHZvaWQgMCAmJiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVVeikgewogICAgICAgICAgICAgICAgICB2YXIgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNywgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjOCwgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjOTsKICAgICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlICs9ICgoX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNyA9IHJlcG9ydFJvd0ZpZWxkID09PSBudWxsIHx8IHJlcG9ydFJvd0ZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVVeikgIT09IG51bGwgJiYgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNyAhPT0gdm9pZCAwID8gX3JlcG9ydFJvd0ZpZWxkJHNlbGVjNyA6ICcnKSArICIsICI7CiAgICAgICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS52YWx1ZVN0cmluZyArPSAoKF9yZXBvcnRSb3dGaWVsZCRzZWxlYzggPSByZXBvcnRSb3dGaWVsZCA9PT0gbnVsbCB8fCByZXBvcnRSb3dGaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVwb3J0Um93RmllbGQuc2VsZWN0VmFsdWVOYW1lVXopICE9PSBudWxsICYmIF9yZXBvcnRSb3dGaWVsZCRzZWxlYzggIT09IHZvaWQgMCA/IF9yZXBvcnRSb3dGaWVsZCRzZWxlYzggOiAnJykgKyAiLCAiOwogICAgICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0uc2VsZWN0VmFsdWVOYW1lVXogKz0gKChfcmVwb3J0Um93RmllbGQkc2VsZWM5ID0gcmVwb3J0Um93RmllbGQgPT09IG51bGwgfHwgcmVwb3J0Um93RmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlcG9ydFJvd0ZpZWxkLnNlbGVjdFZhbHVlTmFtZVV6KSAhPT0gbnVsbCAmJiBfcmVwb3J0Um93RmllbGQkc2VsZWM5ICE9PSB2b2lkIDAgPyBfcmVwb3J0Um93RmllbGQkc2VsZWM5IDogJycpICsgIiwgIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyZXBvcnRSb3dGaWVsZCAhPT0gbnVsbCAmJiByZXBvcnRSb3dGaWVsZCAhPT0gdm9pZCAwICYmIHJlcG9ydFJvd0ZpZWxkLnNlbGVjdFZhbHVlTmFtZUVuKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVwb3J0Um93RmllbGQkc2VsZWMxMDsKICAgICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnNlbGVjdFZhbHVlTmFtZUVuICs9ICgoX3JlcG9ydFJvd0ZpZWxkJHNlbGVjMTAgPSByZXBvcnRSb3dGaWVsZCA9PT0gbnVsbCB8fCByZXBvcnRSb3dGaWVsZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVwb3J0Um93RmllbGQuc2VsZWN0VmFsdWVOYW1lRW4pICE9PSBudWxsICYmIF9yZXBvcnRSb3dGaWVsZCRzZWxlYzEwICE9PSB2b2lkIDAgPyBfcmVwb3J0Um93RmllbGQkc2VsZWMxMCA6ICcnKSArICIsICI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocmVwb3J0Um93RmllbGQgIT09IG51bGwgJiYgcmVwb3J0Um93RmllbGQgIT09IHZvaWQgMCAmJiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVMdCkgewogICAgICAgICAgICAgICAgICB2YXIgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjMTE7CiAgICAgICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS5zZWxlY3RWYWx1ZU5hbWVMdCArPSAoKF9yZXBvcnRSb3dGaWVsZCRzZWxlYzExID0gcmVwb3J0Um93RmllbGQgPT09IG51bGwgfHwgcmVwb3J0Um93RmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlcG9ydFJvd0ZpZWxkLnNlbGVjdFZhbHVlTmFtZUx0KSAhPT0gbnVsbCAmJiBfcmVwb3J0Um93RmllbGQkc2VsZWMxMSAhPT0gdm9pZCAwID8gX3JlcG9ydFJvd0ZpZWxkJHNlbGVjMTEgOiAnJykgKyAiLCAiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHJlcG9ydFJvd0ZpZWxkICE9PSBudWxsICYmIHJlcG9ydFJvd0ZpZWxkICE9PSB2b2lkIDAgJiYgcmVwb3J0Um93RmllbGQuc2VsZWN0VmFsdWVOYW1lUnUpIHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZXBvcnRSb3dGaWVsZCRzZWxlYzEyOwogICAgICAgICAgICAgICAgICByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0uc2VsZWN0VmFsdWVOYW1lUnUgKz0gKChfcmVwb3J0Um93RmllbGQkc2VsZWMxMiA9IHJlcG9ydFJvd0ZpZWxkID09PSBudWxsIHx8IHJlcG9ydFJvd0ZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXBvcnRSb3dGaWVsZC5zZWxlY3RWYWx1ZU5hbWVSdSkgIT09IG51bGwgJiYgX3JlcG9ydFJvd0ZpZWxkJHNlbGVjMTIgIT09IHZvaWQgMCA/IF9yZXBvcnRSb3dGaWVsZCRzZWxlYzEyIDogJycpICsgIiwgIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKCgoX3JlcG9ydERhdGEkZG9jVGFibGVGMTIgPSByZXBvcnREYXRhW2RvY1RhYmxlRmllbGRJbmRleF0pID09PSBudWxsIHx8IF9yZXBvcnREYXRhJGRvY1RhYmxlRjEyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcmVwb3J0RGF0YSRkb2NUYWJsZUYxMi52YWx1ZVN0cmluZykgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJlcG9ydERhdGFbZG9jVGFibGVGaWVsZEluZGV4XS52YWx1ZVN0cmluZyA9ICcnOwogICAgICAgICAgICAgICAgcmVwb3J0RGF0YVtkb2NUYWJsZUZpZWxkSW5kZXhdLnZhbHVlID0gJyc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIGZvciAodmFyIHJlcG9ydFJvd0luZGV4IGluIHJlcG9ydHMpIHsKICAgICAgICAgIF9sb29wMygpOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpIGluIHJlcG9ydERhdGEpIHsKICAgICAgICAgIHZhciBjb3VudCA9IHN1bUJpZ0ludGVnZXJDb3VudFtyZXBvcnREYXRhW2ldLmNvbHVtbklkXTsKICAgICAgICAgIGlmIChyZXBvcnREYXRhW2ldLnR5cGVDb2RlID09PSAnQklHREVDSU1BTCcgJiYgY291bnQgPiAwKSB7CiAgICAgICAgICAgIHJlcG9ydERhdGFbaV0udmFsdWVCaWdEZWNpbWFsIC89IGNvdW50OwogICAgICAgICAgfQogICAgICAgICAgcmVwb3J0RGF0YVtpXS5zZWxlY3RWYWx1ZU5hbWVFbiA9IHJlcG9ydERhdGFbaV0uc2VsZWN0VmFsdWVOYW1lRW4gPyByZXBvcnREYXRhW2ldLnNlbGVjdFZhbHVlTmFtZUVuLnRyaW0oKS5zbGljZSgwLCAtMSkgOiAnJzsKICAgICAgICAgIHJlcG9ydERhdGFbaV0uc2VsZWN0VmFsdWVOYW1lTHQgPSByZXBvcnREYXRhW2ldLnNlbGVjdFZhbHVlTmFtZUx0ID8gcmVwb3J0RGF0YVtpXS5zZWxlY3RWYWx1ZU5hbWVMdC50cmltKCkuc2xpY2UoMCwgLTEpIDogJyc7CiAgICAgICAgICByZXBvcnREYXRhW2ldLnNlbGVjdFZhbHVlTmFtZVJ1ID0gcmVwb3J0RGF0YVtpXS5zZWxlY3RWYWx1ZU5hbWVSdSA/IHJlcG9ydERhdGFbaV0uc2VsZWN0VmFsdWVOYW1lUnUudHJpbSgpLnNsaWNlKDAsIC0xKSA6ICcnOwogICAgICAgICAgcmVwb3J0RGF0YVtpXS5zZWxlY3RWYWx1ZU5hbWVVeiA9IHJlcG9ydERhdGFbaV0uc2VsZWN0VmFsdWVOYW1lVXogPyByZXBvcnREYXRhW2ldLnNlbGVjdFZhbHVlTmFtZVV6LnRyaW0oKS5zbGljZSgwLCAtMSkgOiAnJzsKICAgICAgICB9CiAgICAgICAgX3RoaXMxMC5jb2xsZWN0ZWRSZXBvcnRGb3JUYWJsZVJlcG9ydC5wdXNoKHJlcG9ydERhdGEpOwogICAgICAgIHNlcXVlbmNlKys7CiAgICAgIH0pOwogICAgfSwKICAgIHNlbGVjdERvY1JlcG9ydEl0ZW06IGZ1bmN0aW9uIHNlbGVjdERvY1JlcG9ydEl0ZW0oaW5kZXgpIHsKICAgICAgdmFyIGl0ZW0gPSB0aGlzLnRhYmxlTGlzdFtpbmRleF07CiAgICAgIGlmICh0aGlzLnNlbGVjdGVkRG9jUmVwb3J0cy5kb2NUYWJsZUlkID09PSBmYWxzZSkgewogICAgICAgIHRoaXMuc2VsZWN0ZWREb2NSZXBvcnRzLmRvY1RhYmxlSWQgPSBpdGVtLmRvY1RhYmxlSWQ7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuc2VsZWN0ZWREb2NSZXBvcnRzLmluZGV4U2V0LmhhcyhpdGVtLnJlcG9ydElkKSkgewogICAgICAgIGlmICh0aGlzLnNlbGVjdGVkRG9jUmVwb3J0cy5kb2NUYWJsZUlkID09PSBpdGVtLmRvY1RhYmxlSWQpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWREb2NSZXBvcnRzLmluZGV4U2V0LmRlbGV0ZShpdGVtLnJlcG9ydElkKTsKICAgICAgICAgIHRoaXMudGFibGVMaXN0W2luZGV4XS5zZWxlY3RlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZERvY1JlcG9ydHMuZG9jVGFibGVJZCA9PT0gaXRlbS5kb2NUYWJsZUlkKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkRG9jUmVwb3J0cy5pbmRleFNldC5hZGQoaXRlbS5yZXBvcnRJZCk7CiAgICAgICAgICB0aGlzLnRhYmxlTGlzdFtpbmRleF0uc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodGhpcy5zZWxlY3RlZERvY1JlcG9ydHMuaW5kZXhTZXQuc2l6ZSA9PT0gMCkgewogICAgICAgIHRoaXMuc2VsZWN0ZWREb2NSZXBvcnRzLmRvY1RhYmxlSWQgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIHByaW50Q29sdW1uOiBmdW5jdGlvbiBwcmludENvbHVtbihjb2x1bW4sIGluZGV4KSB7CiAgICAgIHZhciBfY29sdW1uJHZhbHVlLCBfcmVmMiwgX2NvbHVtbiR2YWx1ZVN0cmluZywgX2NvbHVtbiR2YWx1ZUJpZ0RlY2ltLCBfY29sdW1uJHZhbHVlRGF0ZSwgX2NvbHVtbiR2YWx1ZVN0cmluZzI7CiAgICAgIHN3aXRjaCAoY29sdW1uLnR5cGVDb2RlKSB7CiAgICAgICAgY2FzZSAnU0VRVUVOQ0UnOgogICAgICAgICAgcmV0dXJuIChfY29sdW1uJHZhbHVlID0gY29sdW1uID09PSBudWxsIHx8IGNvbHVtbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sdW1uLnZhbHVlKSAhPT0gbnVsbCAmJiBfY29sdW1uJHZhbHVlICE9PSB2b2lkIDAgPyBfY29sdW1uJHZhbHVlIDogaW5kZXggKyAxOwogICAgICAgIGNhc2UgJ1NUUklORyc6CiAgICAgICAgICByZXR1cm4gKF9yZWYyID0gKF9jb2x1bW4kdmFsdWVTdHJpbmcgPSBjb2x1bW4gPT09IG51bGwgfHwgY29sdW1uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb2x1bW4udmFsdWVTdHJpbmcpICE9PSBudWxsICYmIF9jb2x1bW4kdmFsdWVTdHJpbmcgIT09IHZvaWQgMCA/IF9jb2x1bW4kdmFsdWVTdHJpbmcgOiBjb2x1bW4gPT09IG51bGwgfHwgY29sdW1uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb2x1bW4udmFsdWUpICE9PSBudWxsICYmIF9yZWYyICE9PSB2b2lkIDAgPyBfcmVmMiA6ICcnOwogICAgICAgIGNhc2UgJ0JJR0RFQ0lNQUwnOgogICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNhc2UtZGVjbGFyYXRpb25zCiAgICAgICAgICB2YXIgdiA9IChfY29sdW1uJHZhbHVlQmlnRGVjaW0gPSBjb2x1bW4gPT09IG51bGwgfHwgY29sdW1uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb2x1bW4udmFsdWVCaWdEZWNpbWFsKSAhPT0gbnVsbCAmJiBfY29sdW1uJHZhbHVlQmlnRGVjaW0gIT09IHZvaWQgMCA/IF9jb2x1bW4kdmFsdWVCaWdEZWNpbSA6IDA7CiAgICAgICAgICB2ID0gdi50b0ZpeGVkKDIpOwogICAgICAgICAgaWYgKCFpc05hTih2KSkgewogICAgICAgICAgICByZXR1cm4gdjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICBjYXNlICdCT09MRUFOJzoKICAgICAgICAgIHJldHVybiBjb2x1bW4gIT09IG51bGwgJiYgY29sdW1uICE9PSB2b2lkIDAgJiYgY29sdW1uLnZhbHVlQm9vbGVhbiA/IHRoaXMuJHQoJ2FjdGlvbnMueWVzJykgOiB0aGlzLiR0KCdhY3Rpb25zLm5vJyk7CiAgICAgICAgY2FzZSAnREFURSc6CiAgICAgICAgICByZXR1cm4gKF9jb2x1bW4kdmFsdWVEYXRlID0gY29sdW1uID09PSBudWxsIHx8IGNvbHVtbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sdW1uLnZhbHVlRGF0ZSkgIT09IG51bGwgJiYgX2NvbHVtbiR2YWx1ZURhdGUgIT09IHZvaWQgMCA/IF9jb2x1bW4kdmFsdWVEYXRlIDogJyc7CiAgICAgICAgY2FzZSAnWUVBUic6CiAgICAgICAgICByZXR1cm4gKF9jb2x1bW4kdmFsdWVTdHJpbmcyID0gY29sdW1uID09PSBudWxsIHx8IGNvbHVtbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sdW1uLnZhbHVlU3RyaW5nKSAhPT0gbnVsbCAmJiBfY29sdW1uJHZhbHVlU3RyaW5nMiAhPT0gdm9pZCAwID8gX2NvbHVtbiR2YWx1ZVN0cmluZzIgOiAnJzsKICAgICAgICBjYXNlICdTRUxFQ1QnOgogICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TmFtZSh7CiAgICAgICAgICAgIG5hbWVVejogY29sdW1uID09PSBudWxsIHx8IGNvbHVtbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sdW1uLnNlbGVjdFZhbHVlTmFtZVV6LAogICAgICAgICAgICBuYW1lUnU6IGNvbHVtbiA9PT0gbnVsbCB8fCBjb2x1bW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbHVtbi5zZWxlY3RWYWx1ZU5hbWVSdSwKICAgICAgICAgICAgbmFtZUx0OiBjb2x1bW4gPT09IG51bGwgfHwgY29sdW1uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb2x1bW4uc2VsZWN0VmFsdWVOYW1lTHQKICAgICAgICAgIH0pLnRyaW0oJyAsJyk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgfQogICAgfSwKICAgIGdldFRhYmxlTGlzdDogZnVuY3Rpb24gZ2V0VGFibGVMaXN0KCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpZiAoIShfdGhpczExLnBhcmFtcy5kb2NUYWJsZUlkICYmIF90aGlzMTEucGFyYW1zLmRhdGVUeXBlSWQpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgX3RoaXMxMS50YWJsZUxpc3RMZW5ndGggPSAwOwogICAgICAgICAgICAgIF90aGlzMTEudGFibGVMaXN0TGVuZ3RoID0gMDsKICAgICAgICAgICAgICBfdGhpczExLnRhYmxlTGlzdCA9IFtdOwogICAgICAgICAgICAgIF90aGlzMTEubG9hZGVyID0gdHJ1ZTsKICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDc7CiAgICAgICAgICAgICAgcmV0dXJuIHJlcG9ydFNlcnZpY2UucmVwb3J0TGlzdEZvckNvbGxlY3Rpb24oX3RoaXMxMS5wYXJhbXMuZG9jVGFibGVJZCwgX3RoaXMxMS5wYXJhbXMuZGF0ZVR5cGVJZCwgX29iamVjdFNwcmVhZCh7fSwgX3RoaXMxMS52YXJfZGVmYXVsdF9zZWFyY2hfcGF5bG9hZCkpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5saXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgX3RoaXMxMS50YWJsZUxpc3RMZW5ndGggPSByZXNwb25zZS5kYXRhLnRvdGFsOwogICAgICAgICAgICAgICAgICBfdGhpczExLnRhYmxlTGlzdCA9IHJlc3BvbnNlLmRhdGEubGlzdC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpdGVtKSwge30sIHsKICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBfdGhpczExLnNlbGVjdGVkRG9jUmVwb3J0cy5pbmRleFNldC5oYXMoaXRlbS5yZXBvcnRJZCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBfdGhpczExLnRhYmxlTGlzdExlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICAgIF90aGlzMTEudGFibGVMaXN0ID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpczExLmxvYWRlciA9IGZhbHNlOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBoYW5kbGVFeHBvcnRFeGNlbDogZnVuY3Rpb24gaGFuZGxlRXhwb3J0RXhjZWwoKSB7CiAgICAgIHZhciBfdGFibGUkY2hpbGRyZW4sCiAgICAgICAgX3RoaXMxMiA9IHRoaXM7CiAgICAgIHZhciBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgIHZhciBkYXRlRE1ZID0gY3VycmVudERhdGUuZ2V0RGF0ZSgpICsgJy0nICsgKGN1cnJlbnREYXRlLmdldE1vbnRoKCkgKyAxKSArICctJyArIGN1cnJlbnREYXRlLmdldEZ1bGxZZWFyKCk7CiAgICAgIHZhciBmaWxlTmFtZSA9IHRoaXMuZ2V0TmFtZSh0aGlzLnNlbGVjdGVkRG9jUmVwb3J0cy5kb2NUYWJsZSkgKyBkYXRlRE1ZOwogICAgICB2YXIgdGFibGUgPSB0aGlzLiRyZWZzLmNvbGxlY3RlZFJlcG9ydFRhYmxlOwogICAgICB0YWJsZS5zZXRBdHRyaWJ1dGUoJ2JvcmRlcicsICcxJyk7CiAgICAgIHRhYmxlLnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgYmxhY2snOwogICAgICAoX3RhYmxlJGNoaWxkcmVuID0gdGFibGUuY2hpbGRyZW4pID09PSBudWxsIHx8IF90YWJsZSRjaGlsZHJlbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RhYmxlJGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKHRoZWFkT3JUYm9keSkgewogICAgICAgIHRoZWFkT3JUYm9keS5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uICh0cikgewogICAgICAgICAgdHIuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAodGhPclRkKSB7CiAgICAgICAgICAgIHRoT3JUZC53aWR0aCA9IHRoT3JUZC5vZmZzZXRXaWR0aCArICdweCc7CiAgICAgICAgICAgIHRoT3JUZC5zdHlsZS53aWR0aCA9IHRoT3JUZC5vZmZzZXRXaWR0aCArICdweCc7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHZhciB3YiA9IFhMU1gudXRpbHMudGFibGVfdG9fYm9vayh0YWJsZSwgewogICAgICAgIHNoZWV0OiAic2hlZXQxIgogICAgICB9KTsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gdG9kbyBuZWdhIGJ1IGtlcmFrbGlnaW5pIHRla3NoaXJpc2gga2VyYWssIGNvcHkgb2xpYiBxb3lnYW5tYW4KICAgICAgICBfdGhpczEyLmxvYWRlckV4Y2VsID0gZmFsc2U7CiAgICAgIH0sIDUwMCk7CiAgICAgIHJldHVybiBYTFNYLndyaXRlRmlsZSh3YiwgIiIuY29uY2F0KGZpbGVOYW1lLCAiLnhsc3giKSwge30pOwogICAgfSwKICAgIGhhbmRsZVNhdmVEYXRhT3Blbk1vZGFsOiBmdW5jdGlvbiBoYW5kbGVTYXZlRGF0YU9wZW5Nb2RhbCgpIHsKICAgICAgdGhpcy4kYnZNb2RhbC5zaG93KCdzYXZlRGF0YU1vZGFsJyk7CiAgICB9LAogICAgaGFuZGxlU2F2ZURhdGE6IGZ1bmN0aW9uIGhhbmRsZVNhdmVEYXRhKGUpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwogICAgICB0aGlzLmNvbXB1dGVkT2JTZXJ2ZXJTYXZlRGF0YS52YWxpZGF0ZSgpLnRoZW4oZnVuY3Rpb24gKGlzVmFsaWQpIHsKICAgICAgICBpZiAoIWlzVmFsaWQpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgX3RoaXMxMy5sb2FkZXIgPSB0cnVlOwogICAgICAgIHZhciBkYXRhID0gW107CiAgICAgICAgZm9yICh2YXIga2V5IGluIF90aGlzMTMuY29sbGVjdGVkUmVwb3J0Rm9yVGFibGVSZXBvcnQpIHsKICAgICAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihfdGhpczEzLmNvbGxlY3RlZFJlcG9ydEZvclRhYmxlUmVwb3J0W2tleV0pLAogICAgICAgICAgICBfc3RlcDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgdmFyIHZhbCA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgIGlmICghdmFsLnR5cGVDb2RlIHx8IHZhbC50eXBlQ29kZSA9PT0gJ1NFUVVFTkNFJyB8fCAhdmFsLmNvbHVtbklkIHx8ICF2YWwuZG9jUmVwb3J0SWQpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodmFsLnR5cGVDb2RlID09PSAnU0VMRUNUJyAmJiBfdHlwZW9mKHZhbC5zZWxlY3RWYWx1ZUlkKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICAgIHZhciBfcmVmMywgX3NlbGVjdFZhbHVlJG5hbWVVeiwgX3JlZjQsIF9zZWxlY3RWYWx1ZSRuYW1lUnUsIF9yZWY1LCBfc2VsZWN0VmFsdWUkbmFtZUx0LCBfcmVmNiwgX3NlbGVjdFZhbHVlJG5hbWVFbjsKICAgICAgICAgICAgICAgIHZhciBzZWxlY3RWYWx1ZSA9IHZhbC5zZWxlY3RWYWx1ZUlkOwogICAgICAgICAgICAgICAgZGF0YS5wdXNoKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdmFsKSwge30sIHsKICAgICAgICAgICAgICAgICAgZHluYW1pY1Jvd0lkOiBrZXkgKyAxLAogICAgICAgICAgICAgICAgICBzZWxlY3RWYWx1ZUlkOiBzZWxlY3RWYWx1ZSA9PT0gbnVsbCB8fCBzZWxlY3RWYWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0VmFsdWUuaWQsCiAgICAgICAgICAgICAgICAgIHZhbHVlOiBudWxsLAogICAgICAgICAgICAgICAgICB2YWx1ZVN0cmluZzogbnVsbCwKICAgICAgICAgICAgICAgICAgc2VsZWN0VmFsdWVOYW1lVXo6IChfcmVmMyA9IChfc2VsZWN0VmFsdWUkbmFtZVV6ID0gc2VsZWN0VmFsdWUgPT09IG51bGwgfHwgc2VsZWN0VmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdFZhbHVlLm5hbWVVeikgIT09IG51bGwgJiYgX3NlbGVjdFZhbHVlJG5hbWVVeiAhPT0gdm9pZCAwID8gX3NlbGVjdFZhbHVlJG5hbWVVeiA6IHNlbGVjdFZhbHVlID09PSBudWxsIHx8IHNlbGVjdFZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RWYWx1ZS5uYW1lKSAhPT0gbnVsbCAmJiBfcmVmMyAhPT0gdm9pZCAwID8gX3JlZjMgOiAnJywKICAgICAgICAgICAgICAgICAgc2VsZWN0VmFsdWVOYW1lUnU6IChfcmVmNCA9IChfc2VsZWN0VmFsdWUkbmFtZVJ1ID0gc2VsZWN0VmFsdWUgPT09IG51bGwgfHwgc2VsZWN0VmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdFZhbHVlLm5hbWVSdSkgIT09IG51bGwgJiYgX3NlbGVjdFZhbHVlJG5hbWVSdSAhPT0gdm9pZCAwID8gX3NlbGVjdFZhbHVlJG5hbWVSdSA6IHNlbGVjdFZhbHVlID09PSBudWxsIHx8IHNlbGVjdFZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RWYWx1ZS5uYW1lKSAhPT0gbnVsbCAmJiBfcmVmNCAhPT0gdm9pZCAwID8gX3JlZjQgOiAnJywKICAgICAgICAgICAgICAgICAgc2VsZWN0VmFsdWVOYW1lTHQ6IChfcmVmNSA9IChfc2VsZWN0VmFsdWUkbmFtZUx0ID0gc2VsZWN0VmFsdWUgPT09IG51bGwgfHwgc2VsZWN0VmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdFZhbHVlLm5hbWVMdCkgIT09IG51bGwgJiYgX3NlbGVjdFZhbHVlJG5hbWVMdCAhPT0gdm9pZCAwID8gX3NlbGVjdFZhbHVlJG5hbWVMdCA6IHNlbGVjdFZhbHVlID09PSBudWxsIHx8IHNlbGVjdFZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RWYWx1ZS5uYW1lKSAhPT0gbnVsbCAmJiBfcmVmNSAhPT0gdm9pZCAwID8gX3JlZjUgOiAnJywKICAgICAgICAgICAgICAgICAgc2VsZWN0VmFsdWVOYW1lRW46IChfcmVmNiA9IChfc2VsZWN0VmFsdWUkbmFtZUVuID0gc2VsZWN0VmFsdWUgPT09IG51bGwgfHwgc2VsZWN0VmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbGVjdFZhbHVlLm5hbWVFbikgIT09IG51bGwgJiYgX3NlbGVjdFZhbHVlJG5hbWVFbiAhPT0gdm9pZCAwID8gX3NlbGVjdFZhbHVlJG5hbWVFbiA6IHNlbGVjdFZhbHVlID09PSBudWxsIHx8IHNlbGVjdFZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RWYWx1ZS5uYW1lKSAhPT0gbnVsbCAmJiBfcmVmNiAhPT0gdm9pZCAwID8gX3JlZjYgOiAnJywKICAgICAgICAgICAgICAgICAgcm93SWQ6IG51bGwKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkYXRhLnB1c2goX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB2YWwpLCB7fSwgewogICAgICAgICAgICAgICAgZHluYW1pY1Jvd0lkOiBrZXkgKyAxLAogICAgICAgICAgICAgICAgcm93SWQ6IG51bGwKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIGluZm8gPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIF90aGlzMTMuc2F2ZURhdGEucmVwb3J0SW5mb0ZvckdhdGhlciksIHt9LCB7CiAgICAgICAgICB0YWJsZUlkOiBfdGhpczEzLnBhcmFtcy5kb2NUYWJsZUlkLAogICAgICAgICAgZGF0ZVR5cGVJZDogX3RoaXMxMy5wYXJhbXMuZGF0ZVR5cGVJZCwKICAgICAgICAgIGdhdGhlclR5cGU6IF90aGlzMTMuY29sbGVjdGluZ1R5cGUKICAgICAgICB9KTsKICAgICAgICByZXBvcnRTZXJ2aWNlLmNyZWF0ZUFuZEZpbGxHYXRoZXJSZXBvcnQoaW5mbywgZGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBfdGhpczEzLiR0b2FzdChfdGhpczEzLiR0KCdtZXNzYWdlcy5zYXZlZF9zdWNjZXNzZnVsbHknKSwgewogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgICAgIH0pOwogICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMxMy5sb2FkZXIgPSBmYWxzZTsKICAgICAgICAgIF90aGlzMTMuJGJ2TW9kYWwuaGlkZSgnc2F2ZURhdGFNb2RhbCcpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBvd25Eb2NUYWJsZXNWYWx1ZTogZnVuY3Rpb24gb3duRG9jVGFibGVzVmFsdWUob3B0KSB7CiAgICAgIHZhciBfaXRlbSR0ZXh0OwogICAgICB2YXIgaXRlbSA9IHRoaXMub3duRG9jVGFibGVMaXN0T3B0aW9ucy5maW5kKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGUudmFsdWUgPT09IG9wdDsKICAgICAgfSk7CiAgICAgIHJldHVybiAoX2l0ZW0kdGV4dCA9IGl0ZW0udGV4dCkgIT09IG51bGwgJiYgX2l0ZW0kdGV4dCAhPT0gdm9pZCAwID8gX2l0ZW0kdGV4dCA6ICcnOwogICAgfSwKICAgIGxhYmVsQ29sbGVjdGVkU2VsZWN0OiBmdW5jdGlvbiBsYWJlbENvbGxlY3RlZFNlbGVjdChfcmVmNykgewogICAgICB2YXIgbmFtZVV6ID0gX3JlZjcubmFtZVV6LAogICAgICAgIG5hbWVMdCA9IF9yZWY3Lm5hbWVMdCwKICAgICAgICBuYW1lUnUgPSBfcmVmNy5uYW1lUnUsCiAgICAgICAgbmFtZSA9IF9yZWY3Lm5hbWU7CiAgICAgIHJldHVybiBuYW1lVXogPyB0aGlzLmdldE5hbWUoewogICAgICAgIG5hbWVVejogbmFtZVV6LAogICAgICAgIG5hbWVMdDogbmFtZUx0LAogICAgICAgIG5hbWVSdTogbmFtZVJ1CiAgICAgIH0pIDogbmFtZTsKICAgIH0sCiAgICBmaW5kRmllbGRCeUlkOiBmdW5jdGlvbiBmaW5kRmllbGRCeUlkKGlkKSB7CiAgICAgIHJldHVybiB0aGlzLmRvY1RhYmxlRmllbGRzU2VyaWFsaXplZC5maW5kKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGUuaWQgPT09IGlkOwogICAgICB9KTsKICAgIH0sCiAgICBzZWxlY3RGZXRjaE9wdGlvbnM6IGZ1bmN0aW9uIHNlbGVjdEZldGNoT3B0aW9ucyhjb2x1bW4sIGtleXdvcmQpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlOCgpIHsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KF90aGlzMTQuc2VsZWN0TG9hZEl0ZW1UaW1lT3V0KTsKICAgICAgICAgICAgICBfdGhpczE0LnNlbGVjdExvYWRJdGVtVGltZU91dCA9IHNldFRpbWVvdXQoIC8qI19fUFVSRV9fKi9fYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICAgICAgICAgICAgdmFyIGZpZWxkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIF90aGlzMTQuc2VsZWN0TG9hZEl0ZW1Mb2FkZXIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBfdGhpczE0LmZpbmRGaWVsZEJ5SWQoY29sdW1uLmNvbHVtbklkKTsKICAgICAgICAgICAgICAgICAgICAgIGNydWRBbmRMaXN0c1NlcnZpY2Uuc2VhcmNoTGlzdFdpdGhLZXl3b3JkKGZpZWxkLnJlZmVyZW5jZVVybCwgewogICAgICAgICAgICAgICAgICAgICAgICBrZXl3b3JkOiBrZXl3b3JkLAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1BlclBhZ2U6IDEwLAogICAgICAgICAgICAgICAgICAgICAgICBwYWdlOiAxCiAgICAgICAgICAgICAgICAgICAgICB9LCBmaWVsZC5yZWZlcmVuY2VBcHBlbmRVcmwpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIkRlcGFydG1lbnRGb3JEb2N1bWVudCIgPT09IGZpZWxkLnJlZkNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczE0LnNlbGVjdE9wdGlvbnNCeVJlZmVyZW5jZVVybFtmaWVsZC5pZF0gPSByZXMuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczE0LnNlbGVjdE9wdGlvbnNCeVJlZmVyZW5jZVVybFtmaWVsZC5pZF0gPSByZXMuZGF0YS5saXN0OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMTQuc2VsZWN0TG9hZEl0ZW1Mb2FkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczE0LnNlbGVjdExvYWRJdGVtTG9hZGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCBfY2FsbGVlNyk7CiAgICAgICAgICAgICAgfSkpLCA1MDApOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTgpOwogICAgICB9KSkoKTsKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBvd25Eb2NUYWJsZUxpc3RPcHRpb25zOiBmdW5jdGlvbiBvd25Eb2NUYWJsZUxpc3RPcHRpb25zKCkgewogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CiAgICAgIGlmICh0aGlzLm93bkRvY1RhYmxlTGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub3duRG9jVGFibGVMaXN0Lm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdGV4dDogX3RoaXMxNS5nZXROYW1lKHsKICAgICAgICAgICAgICBuYW1lVXo6IGl0ZW0ubmFtZVV6LAogICAgICAgICAgICAgIG5hbWVSdTogaXRlbS5uYW1lUnUsCiAgICAgICAgICAgICAgbmFtZUx0OiBpdGVtLm5hbWVMdAogICAgICAgICAgICB9KSwKICAgICAgICAgICAgdmFsdWU6IGl0ZW0uaWQKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIFtdOwogICAgfSwKICAgIG93bkRhdGVUeXBlTGlzdE9wdGlvbnM6IGZ1bmN0aW9uIG93bkRhdGVUeXBlTGlzdE9wdGlvbnMoKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKICAgICAgaWYgKHRoaXMuZGF0ZVR5cGVMaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5kYXRlVHlwZUxpc3QubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0ZXh0OiBfdGhpczE2LmdldE5hbWUoewogICAgICAgICAgICAgIG5hbWVVejogaXRlbS5uYW1lVXosCiAgICAgICAgICAgICAgbmFtZVJ1OiBpdGVtLm5hbWVSdSwKICAgICAgICAgICAgICBuYW1lTHQ6IGl0ZW0ubmFtZUx0CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICB2YWx1ZTogaXRlbS5pZAogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gW107CiAgICB9LAogICAgY29tcHV0ZWRPYlNlcnZlclNhdmVEYXRhOiBmdW5jdGlvbiBjb21wdXRlZE9iU2VydmVyU2F2ZURhdGEoKSB7CiAgICAgIHJldHVybiB0aGlzLiRyZWZzLm9iU2VydmVyU2F2ZURhdGE7CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgJ3BhcmFtcy5kb2NUYWJsZUlkJzogZnVuY3Rpb24gcGFyYW1zRG9jVGFibGVJZChkb2NUYWJsZUlkKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoKSB7CiAgICAgICAgdmFyIF90aGlzMTckb3duRG9jVGFibGVMaSwgZGF0ZVR5cGVJZDsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX3RoaXMxNyRvd25Eb2NUYWJsZUxpID0gX3RoaXMxNy5vd25Eb2NUYWJsZUxpc3QuZmluZChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGUuaWQgPT09IGRvY1RhYmxlSWQ7CiAgICAgICAgICAgICAgfSksIGRhdGVUeXBlSWQgPSBfdGhpczE3JG93bkRvY1RhYmxlTGkuZGF0ZVR5cGVJZDsKICAgICAgICAgICAgICBpZiAoIWRhdGVUeXBlSWQpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBfdGhpczE3LmxvYWRlciA9IHRydWU7CiAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA1OwogICAgICAgICAgICAgIHJldHVybiBfdGhpczE3LmdldERhdGVUeXBlTGlzdChkYXRlVHlwZUlkKTsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gODsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIF90aGlzMTcuZGF0ZVR5cGVMaXN0ID0gW107CiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgICd2YXJfZGVmYXVsdF9zZWFyY2hfcGF5bG9hZC5wYWdlJzogZnVuY3Rpb24gdmFyX2RlZmF1bHRfc2VhcmNoX3BheWxvYWRQYWdlKCkgewogICAgICBpZiAodGhpcy5sb2FkZXIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5oYW5kbGVTZWFyY2goZmFsc2UpOwogICAgfQogIH0KfTs="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;AA4QA;AACA;AACA;AACA;AACA;AACA;AAEA;EACAA;IACAC;IACAC;IACAC;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;QACAA;UACAC;UACAC;QACA;QACAC;QACAC;QACAC;MACA;MACAC;QACAC;QACAL;MACA;MACAM;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAZ;QACAK;MACA;MACAQ;MACAC;QACAC;QACAb;QACAc;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC,qBACA;QACAC;QACAC;MACA,GACA;QACAD;QACAC;MACA,GACA;QACAD;QACAC;MACA,EACA;MACAC;QACAC;UACAC;UACAC;UACAC;UACAC;QACA;MACA;IACA;EACA;EACAC;IAAA;IAAA;MAAA;QAAA;UAAA;YAAA;YAAA,OACA;UAAA;YACA;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EACA;EACAC;IACAC;MAAA;MACAC;QACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACAD;QACA;UACA;QACA;MACA,GACAE;QACA;MACA;IACA;IACAC;MAAA;QAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAAC;cACA;gBACA;gBACA;cACA;cAAA;cAAA,OACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IACAC;MACA;QACA;UAAAC;QAAA;QACA;MACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cACA;cACA;cACA;cACA;cAAA,IACA;gBAAA;gBAAA;cAAA;cACA;cAAA;YAAA;cAAA;cAAA,OAGAP;gBAAA;kBAAA;oBAAA;sBAAA;wBACA;0BACA;0BACA;0BACA;wBACA;wBACA;wBAAA;wBAAA,OACA;sBAAA;wBACA;sBAAA;sBAAA;wBAAA;oBAAA;kBAAA;gBAAA,CACA;gBAAA;kBAAA;gBAAA;cAAA;gBACA;cACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IACAQ;MAAA;MAAA;MACA;QACA;MACA;MACAC;QACA;UACA;QACA;UACA;UACA;YACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA,IACA;gBAAA;gBAAA;cAAA;cAAA;YAAA;cAGA;cACA;cAAA;cAAA,OACA;gBACA;gBACAV;kBACA;oBACAW;sBACA;wBACA;sBACA;sBACA;oBACA;kBACA;gBACA;cACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;IACAC;MACA;MACA;QACA;UACA;UACA;QACA;UACA;UACA;QACA;UACA;UACA;MAAA;IAEA;IACAC;MAAA;MACA;MACA;QACA;QAAA,6BACA;UACA;UACA;UACA;YACA;cACAC;YACA;cACA;gBACAA;kBACAzB;kBACA0B;gBACA;gBACAC;cACA;gBACAF;cACA;YACA;UACA;UACA;QACA;QAnBA;UAAA;QAAA;MAoBA;IACA;IACAG;MAAA;MACA;MACA;QACA;QACA;QACA;QAAA,+BACA;UACA;UACA;YAAA;YACA;YACA;cACAC;gBACA7B;gBACA0B;cACA;YACA;YACAG;YACA;cAAA;cACA;cACA;gBACAC;cACA;cACA;gBACAD;cACA;cACA;gBACAC;cACA;cACA;gBAAA;gBACAD;gBACAA;cACA;YACA;cAAA;cACAA;cACAA;cACAA;cACAA;YACA;cAAA;cACA;gBACAA;cACA;cACAA;cACAA;cACA;cACAA;cACAA;cACAA;cACA;gBACA;kBAAA;kBACAA;kBACAA;kBACAA;gBACA;gBACA;kBAAA;kBACAA;gBACA;gBACA;kBAAA;kBACAA;gBACA;gBACA;kBAAA;kBACAA;gBACA;cACA;gBACAA;cACA;YACA;UACA;QACA;QA7DA;UAAA;QAAA;QA8DA;QACAF;MACA;IACA;IACAI;MAAA;MACA;MACA;QACA;QACA;QACA;QAAA,+BACA;UACA;UACA;YAAA;YACA;YACA;cACAF;gBACA7B;gBACA0B;cACA;YACA;YACAG;YACA;cAAA;cACA;cACA;gBACAC;cACA;cACA;gBACAD;cACA;cACA;gBACA;kBACAC;gBACA;cACA;gBACAA;cACA;cACA;gBAAA;gBACAD;gBACAA;cACA;YACA;cAAA;cACAA;cACAA;cACAA;cACAA;YACA;cAAA;cACA;gBACAA;cACA;cACAA;cACAA;cACA;cACAA;cACAA;cACA;gBACA;kBAAA;kBACAA;kBACAA;kBACAA;gBACA;gBACA;kBAAA;kBACAA;gBACA;gBACA;kBAAA;kBACAA;gBACA;gBACA;kBAAA;kBACAA;gBACA;cACA;gBACAA;gBACAA;cACA;YACA;UACA;QACA;QAjEA;UAAA;QAAA;QAkEA;UACA;UACA;YACAA;UACA;UACAA;UACAA;UACAA;UACAA;QACA;QACA;QACAF;MACA;IACA;IACAK;MACA;MACA;QACA;MACA;MACA;QACA;UACA;UACA;QACA;MACA;QACA;UACA;UACA;QACA;MACA;MACA;QACA;MACA;IACA;IACAC;MAAA;MACA;QACA;UACA;QACA;UACA;QACA;UACA;UACA;UACAC;UACA;YACA;UACA;UACA;QACA;UACA;QACA;UACA;QACA;UACA;QACA;UACA;YACA9B;YACAE;YACAD;UACA;QACA;UACA;MAAA;IAEA;IACA8B;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA,MACA;gBAAA;gBAAA;cAAA;cACA;cACA;cACA;cACA;cAAA;cAAA,OACAxB;gBACA;kBACA;kBACA;oBACA;sBAAAyB;oBAAA;kBACA;gBACA;kBACA;kBACA;gBACA;cACA;gBACA;cACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAEA;IACAC;MAAA;QAAA;MACA;MACA;MACA;MACA;MACAC;MACAA;MACA;QACAC;UACAC;YACAC;YACAA;UACA;QACA;MACA;MACA;QAAAC;MAAA;MACAC;QAAA;QACA;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MAAA;MACA;QACA;UACA;QACA;QACA;QACA;QACA;UAAA,2CACA;YAAA;UAAA;YAAA;cAAA;cACA;gBACA;cACA;cACA;gBAAA;gBACA;gBACA3E,0CACA4E;kBACAC;kBACAC;kBACAhD;kBACAiD;kBACAC;kBACAC;kBACAC;kBACAC;kBACAC;gBAAA,GACA;gBACA;cACA;cACApF,0CACA4E;gBACAC;gBACAO;cAAA,GACA;YACA;UAAA;YAAA;UAAA;YAAA;UAAA;QACA;QACA,2CACA;UACAC;UACA3E;UACA4E;QAAA,EACA;QACA7C,oDACA8C;UACA;YAAAxC;UAAA;QACA,GACAJ;UACA;UACA;QACA;MACA;IACA;IACA6C;MAAA;MACA;QAAA;MAAA;MACA;IACA;IACAC;MAAA;QAAAtD;QAAAC;QAAAL;MACA;QAAAG;QAAAC;QAAAC;MAAA;IACA;IACAsD;MACA;QAAA;MAAA;IACA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cACAC;cACA;gBAAA;gBAAA;kBAAA;oBAAA;sBACA;sBACAC;sBACAC;wBACAC;wBACAnF;wBACAL;sBACA,6BACAgF;wBACA;0BACA;wBACA;0BACA;wBACA;sBACA,GACAS;wBACA;sBACA,GACArD;wBACA;sBACA;oBAAA;oBAAA;sBAAA;kBAAA;gBAAA;cAAA,CACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IACA;EACA;EACAsD;IACAC;MAAA;MACA;QACA;UACA;YACAC;cACAjE;cACAE;cACAD;YACA;YACAL;UACA;QACA;MACA;MACA;IACA;IACAsE;MAAA;MACA;QACA;UACA;YACAD;cACAjE;cACAE;cACAD;YACA;YACAL;UACA;QACA;MACA;MACA;IACA;IACAuE;MACA;IACA;EACA;EACAC;IACA;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA,wBACA;gBAAA;cAAA;cAAA,KACA5F;gBAAA;gBAAA;cAAA;cACA;cAAA;cAAA,OACA;YAAA;cAAA;cAAA;YAAA;cAEA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAEA;IACA;MACA;QACA;MACA;MACA;IACA;EACA;AACA","names":["components","BaseDatePickerWithValidation","BaseInputWithValidation","reportHeader","data","title","loader","selectLoadItemLoader","selectLoadItemTimeOut","params","limit","page","search","docTableId","dateTypeId","tableListParams","itemsPerPage","tableList","tableListLength","docTableFieldsOriginal","docTableFieldsSerialized","ownDocTableList","dateTypeList","dateTypeListPayload","selectOptionsByReferenceUrl","selectedDocReports","indexSet","docTable","docReports","collectedReportForTableReport","collectingType","collectionAvgIgnoreZero","collectingGroupColumnId","collectingTypeList","value","name","saveData","reportInfoForGather","nameUz","nameLt","nameRu","date","created","methods","getOwnDocTableList","reportService","getDateTypeList","finally","handleSearch","clearSelected","handleValidateForCollecting","type","handleCollect","deserializeDocTableFields","list","handleCollectView","response","handleCollectedReportDraw","handleCollectedReportDrawAssemble","reportRowData","typeCode","sequence","handleCollectedReportDrawCollectSum","reportData","sumBigIntegerCount","handleCollectedReportDrawCollectAvg","selectDocReportItem","printColumn","v","getTableList","selected","handleExportExcel","table","theadOrTbody","tr","thOrTd","sheet","setTimeout","handleSaveDataOpenModal","handleSaveData","val","dynamicRowId","selectValueId","valueString","selectValueNameUz","selectValueNameRu","selectValueNameLt","selectValueNameEn","rowId","tableId","gatherType","then","ownDocTablesValue","labelCollectedSelect","findFieldById","selectFetchOptions","clearTimeout","field","crudAndListsService","keyword","catch","computed","ownDocTableListOptions","text","ownDateTypeListOptions","computedObServerSaveData","watch"],"sourceRoot":"src/modules/report/collection/assemble","sources":["index.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <b-overlay\r\n        :opacity=\"0.2\"\r\n        :show=\"loader\"\r\n    >\r\n      <div class=\"col-md-12 text-center\">\r\n        <div class=\"h4 mb-4 d-inline-block\">{{ $t('submodules.reports.collection_assemble') }}</div>\r\n      </div>\r\n      <div class=\"card\">\r\n        <div class=\"card-body\">\r\n          <div class=\"row mb-2\">\r\n            <div class=\"col-sm-12\">\r\n              <div class=\"row mb-2\">\r\n                <div class=\"col-md-3\">\r\n                  <BaseMultiselectWithValidation\r\n                      rules=\"required\"\r\n                      class=\"required\"\r\n                      onlyFormElement\r\n                      v-model=\"params.docTableId\"\r\n                      :options=\"ownDocTableListOptions.map(e => e.value)\"\r\n                      :label=\"$t('column.value_type')\"\r\n                      label-on-top\r\n                      placeholder=\"\"\r\n                      :custom-label=\"ownDocTablesValue\"\r\n                      open-direction=\"bottom\"\r\n                      :max-height=\"600\"\r\n                      :show-labels=\"false\"\r\n                  />\r\n                </div>\r\n                <div class=\"col-md-2\">\r\n                  <b-form-select\r\n                      class=\"border-light form-control rounded\"\r\n                      v-model=\"params.dateTypeId\"\r\n                      :disabled=\"ownDateTypeListOptions.length < 1\"\r\n                      :options=\"ownDateTypeListOptions\"></b-form-select>\r\n                </div>\r\n                <div class=\"col-md-2\">\r\n                  <div class=\"search-box\">\r\n                    <div class=\"position-relative\">\r\n                      <input\r\n                          type=\"text\"\r\n                          v-model=\"params.name\"\r\n                          class=\"form-control rounded border-light\"\r\n                          :placeholder=\"$t('actions.search')\"\r\n                      />\r\n                      <i class=\"mdi mdi-magnify search-icon\"></i>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class=\"col-md-2\">\r\n                  <b-btn @click=\"handleSearch\">{{ $t('actions.search') }}</b-btn>\r\n                </div>\r\n                <div class=\"col-md-2\">\r\n                  <b-btn variant=\"success\" @click=\"handleCollect()\"\r\n                         :disabled=\"this.selectedDocReports.indexSet.size < 2\">{{ $t('actions.collect') }}\r\n                  </b-btn>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"col-sm-12\">\r\n              <table class=\"table table-hover table-striped\">\r\n                <thead>\r\n                <tr>\r\n                  <th>{{ '' }}</th>\r\n                  <th>{{ $t('column.name') }}</th>\r\n                  <th>{{ $t('submodules.reports.report_date') }}</th>\r\n                  <th>{{ $t(\"nameShakl\") }}</th>\r\n                  <th>{{ $t(\"titleShakl\") }}</th>\r\n                  <th>{{ $t(\"dateTypes\") }}</th>\r\n                  <th>{{ $t(\"submodules.reports.yur_department\") }}</th>\r\n                  <th>{{ $t(\"submodules.reports.created_datetime\") }}</th>\r\n                </tr>\r\n                </thead>\r\n                <tbody>\r\n                <tr v-for=\"(item, index) in tableList\"\r\n                    :key=\"index\"\r\n                    class=\"cursor-pointer\"\r\n                    @click=\"selectDocReportItem(index)\"\r\n                    :class=\"{'table-info': item.selected, 'table-info': item.selected}\">\r\n                  <td>{{\r\n                      paginate(index, var_default_search_payload.itemsPerPage, var_default_search_payload.page - 1)\r\n                    }}\r\n                  </td>\r\n                  <td>\r\n                    {{\r\n                      getName({\r\n                        nameUz: item.reportNameUz,\r\n                        nameRu: item.reportNameRu,\r\n                        nameLt: item.reportNameLt,\r\n                      })\r\n                    }}\r\n                  </td>\r\n                  <td>{{ item.reportData }}</td>\r\n                  <td>{{\r\n                      getName({\r\n                        nameUz: item.docTableNameUz,\r\n                        nameRu: item.docTableNameRu,\r\n                        nameLt: item.docTableNameLt,\r\n                      })\r\n                    }}\r\n                  </td>\r\n                  <td>{{\r\n                      getName({\r\n                        nameUz: item.docTableTitleUz,\r\n                        nameRu: item.docTableTitleRu,\r\n                        nameLt: item.docTableTitleLt,\r\n                      })\r\n                    }}\r\n                  </td>\r\n                  <td>{{\r\n                      getName({\r\n                        nameUz: item.dateTypeNameUz,\r\n                        nameRu: item.dateTypeNameRu,\r\n                        nameLt: item.dateTypeNameLt,\r\n                      })\r\n                    }}\r\n                  </td>\r\n                  <td>{{\r\n                      getName({\r\n                        nameUz: item.yurDepNameUz,\r\n                        nameRu: item.yurDepNameRu,\r\n                        nameLt: item.yurDepNameLt,\r\n                      })\r\n                    }}\r\n                  </td>\r\n                  <td>{{ item.createdDate }}</td>\r\n                </tr>\r\n                <tr v-if=\"tableList.length <= 0\" :key=\"-1\">\r\n                  <td colspan=\"8\">\r\n                    <h5 class=\"text-center\"> </h5>\r\n                  </td>\r\n                </tr>\r\n                </tbody>\r\n              </table>\r\n              <b-pagination\r\n                  v-if=\"tableListLength > 0\"\r\n                  v-model=\"var_default_search_payload.page\"\r\n                  :total-rows=\"tableListLength\"\r\n                  :per-page=\"var_default_search_payload.itemsPerPage\"\r\n                  aria-controls=\"my-table\"\r\n                  class=\"justify-content-end\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <b-modal id=\"modal\" :title=\"$t('submodules.reports.collection_assemble')\" size=\"xl\">\r\n        <div class=\"row\">\r\n          <div class=\"col-2 my-2\">\r\n            <b-form-select\r\n                class=\"form-control rounded\"\r\n                v-model=\"collectingType\">\r\n              <b-form-select-option\r\n                  v-for=\"(item, index) in collectingTypeList\"\r\n                  :key=\"index\"\r\n                  :value=\"item.value\">\r\n                {{ item.name }}\r\n              </b-form-select-option>\r\n            </b-form-select>\r\n          </div>\r\n          <div class=\"col-1 my-2\">\r\n            <b-btn variant=\"success\" class=\"mx-1\" @click=\"handleCollectedReportDraw\">{{ $t('actions.gather') }}</b-btn>\r\n          </div>\r\n          <div class=\"col-1 my-2\">\r\n            <b-btn variant=\"info\" class=\"mx-1\" @click=\"handleExportExcel\">{{ $t('actions.excel') }}</b-btn>\r\n          </div>\r\n          <div class=\"col-6\"></div>\r\n          <div class=\"col-2 my-2\">\r\n            <b-btn variant=\"success\" block\r\n                   class=\"mx-1\"\r\n                   :disabled=\"!collectedReportForTableReport || collectedReportForTableReport.length <= 0\"\r\n                   @click=\"handleSaveDataOpenModal\">{{ $t('actions.confirm') }}\r\n            </b-btn>\r\n          </div>\r\n          <div class=\"col-2 my-2\" v-if=\"collectingType === 'COLLECT_AVG'\">\r\n            <input type=\"checkbox\" id=\"checkbox\" v-model=\"collectionAvgIgnoreZero\">\r\n            <label for=\"checkbox\">{{ $t('submodules.reports.zero_ignore') }}</label>\r\n          </div>\r\n        </div>\r\n        <table ref=\"collectedReportTable\" class=\"table table-hover table-striped table-custom-bordered\" border=\"1\"\r\n               style=\"border: 1px solid black\">\r\n          <report-header :fields=\"docTableFieldsOriginal\"></report-header>\r\n          <tbody>\r\n          <tr v-for=\"(reportRow, reportRowIndex) in collectedReportForTableReport\" :key=\"reportRowIndex\">\r\n            <td v-for=\"(reportCol, reportColIndex) in reportRow\" :key=\"reportColIndex\">\r\n              <BaseMultiselectWithValidation\r\n                  v-if=\"collectingType !== 'ASSEMBLE' && reportCol.typeCode === 'SELECT'\"\r\n                  v-model=\"collectedReportForTableReport[reportRowIndex][reportColIndex].selectValueId\"\r\n                  :options=\"selectOptionsByReferenceUrl[reportCol.columnId]\"\r\n                  :custom-label=\"labelCollectedSelect\"\r\n                  :label=\"$t('column.employee')\"\r\n                  :only-form-element=\"true\"\r\n                  :internal-search=\"false\"\r\n                  :hide-error-msg=\"false\"\r\n                  :loading=\"selectLoadItemLoader\"\r\n                  :show-labels=\"false\"\r\n                  :filterable=\"false\"\r\n                  :searchable=\"true\"\r\n                  :max-height=\"600\"\r\n                  @search-change=\"(keyword) => selectFetchOptions(reportCol, keyword)\"\r\n                  rules=\"required\"\r\n                  placeholder=\"\"\r\n              ></BaseMultiselectWithValidation>\r\n              {{ printColumn(reportCol, reportColIndex) }}\r\n            </td>\r\n          </tr>\r\n          </tbody>\r\n        </table>\r\n        <template #modal-footer>\r\n          <div>&nbsp;</div>\r\n        </template>\r\n      </b-modal>\r\n      <b-modal id=\"saveDataModal\" :title=\"$t('submodules.reports.collection_assemble')\" size=\"lg\">\r\n        <ValidationObserver ref=\"obServerSaveData\" v-slot=\"{}\">\r\n          <div class=\"row\">\r\n            <div class=\"col-12 my-2\">\r\n              <BaseInputWithValidation\r\n                  rules=\"required\"\r\n                  class=\"required\"\r\n                  @input=\"($event) => (saveData.reportInfoForGather.nameLt = toLatin($event))\"\r\n                  v-model=\"saveData.reportInfoForGather.nameUz\"\r\n                  :label=\"$t('column.name_uz')\"\r\n                  :placeholder=\"$t('column.name_uz')\"\r\n              />\r\n            </div>\r\n            <div class=\"col-12 my-2\">\r\n              <BaseInputWithValidation\r\n                  rules=\"required\"\r\n                  class=\"required\"\r\n                  @input=\"($event) => (saveData.reportInfoForGather.nameUz = toCyrill($event))\"\r\n                  v-model=\"saveData.reportInfoForGather.nameLt\"\r\n                  :label=\"$t('column.name_lt')\"\r\n                  :placeholder=\"$t('column.name_lt')\"\r\n              />\r\n            </div>\r\n            <div class=\"col-12 my-2\">\r\n              <BaseInputWithValidation\r\n                  rules=\"required\"\r\n                  class=\"required\"\r\n                  v-model=\"saveData.reportInfoForGather.nameRu\"\r\n                  :label=\"$t('column.name_ru')\"\r\n                  :placeholder=\"$t('column.name_ru')\"\r\n              />\r\n            </div>\r\n            <div class=\"col-12 my-2\">\r\n              <BaseDatePickerWithValidation\r\n                  rules=\"required\"\r\n                  class=\"required\"\r\n                  v-model=\"saveData.reportInfoForGather.date\"\r\n                  :label=\"$t('column.date')\"\r\n                  :placeholder=\"$t('column.date')\"\r\n                  format=\"DD.MM.YYYY\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </ValidationObserver>\r\n        <template #modal-footer>\r\n          <b-btn variant=\"success\" @click=\"handleSaveData\">\r\n            {{ $t(\"actions.save\") }}\r\n          </b-btn>\r\n        </template>\r\n      </b-modal>\r\n    </b-overlay>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport reportService from \"../../reportService\";\r\nimport reportHeader from \"./reportHeader\";\r\nimport XLSX from \"xlsx\";\r\nimport BaseInputWithValidation from \"@/components/base/BaseInputWithValidation\";\r\nimport BaseDatePickerWithValidation from \"@/components/base/BaseDatePickerWithValidation\";\r\nimport crudAndListsService from \"@/shared/services/crud_and_list.service\";\r\n\r\nexport default {\r\n  components: {\r\n    BaseDatePickerWithValidation,\r\n    BaseInputWithValidation,\r\n    reportHeader\r\n  },\r\n  data() {\r\n    return {\r\n      title: this.$t(\"reportRoles\"),\r\n      loader: true,\r\n      selectLoadItemLoader: null,\r\n      selectLoadItemTimeOut: null,\r\n      params: {\r\n        params: {\r\n          limit: 20,\r\n          page: 0,\r\n        },\r\n        search: \"\",\r\n        docTableId: \"\",\r\n        dateTypeId: \"\",\r\n      },\r\n      tableListParams: {\r\n        itemsPerPage: 20,\r\n        page: 0,\r\n      },\r\n      tableList: [],\r\n      tableListLength: 0,\r\n      docTableFieldsOriginal: [],\r\n      docTableFieldsSerialized: [],\r\n      ownDocTableList: [],\r\n      dateTypeList: [],\r\n      dateTypeListPayload: {\r\n        page: 0,\r\n        itemsPerPage: 100\r\n      },\r\n      selectOptionsByReferenceUrl: {},\r\n      selectedDocReports: {\r\n        indexSet: new Set(),\r\n        docTableId: false,\r\n        docTable: null,\r\n        docReports: {},\r\n      },\r\n      collectedReportForTableReport: [],\r\n      collectingType: 'ASSEMBLE',\r\n      collectionAvgIgnoreZero: false,\r\n      collectingGroupColumnId: null,\r\n      collectingTypeList: [\r\n        {\r\n          value: \"ASSEMBLE\",\r\n          name: \"Yig'ish\",\r\n        },\r\n        {\r\n          value: \"COLLECT_SUM\",\r\n          name: \"Yig'indini yig'ish (SUM)\",\r\n        },\r\n        {\r\n          value: \"COLLECT_AVG\",\r\n          name: \"O'rtacha qiymat yig'ish (AVG)\",\r\n        },\r\n      ],\r\n      saveData: {\r\n        reportInfoForGather: {\r\n          nameUz: '',\r\n          nameLt: '',\r\n          nameRu: '',\r\n          date: '',\r\n        }\r\n      }\r\n    };\r\n  },\r\n  async created() {\r\n    await this.getOwnDocTableList();\r\n    this.loader = false;\r\n  },\r\n  methods: {\r\n    getOwnDocTableList() {\r\n      reportService.getOwnTable(this.params).then(response => {\r\n        if (response.data.list.length > 0) {\r\n          this.ownDocTableList = response.data.list;\r\n        }\r\n      });\r\n    },\r\n    getDateTypeList(dateTypeId) {\r\n      reportService.getListByParentId(dateTypeId, this.dateTypeListPayload).then(response => {\r\n        if (response.data.list.length > 0) {\r\n          this.dateTypeList = response.data.list;\r\n        }\r\n      })\r\n          .finally(() => {\r\n            this.loader = false;\r\n          });\r\n    },\r\n    async handleSearch(clearSelected = true) {\r\n      if (clearSelected) {\r\n        this.selectedDocReports.docTableId = false;\r\n        this.selectedDocReports.indexSet = new Set();\r\n      }\r\n      await this.getTableList();\r\n    },\r\n    handleValidateForCollecting() {\r\n      if (!this.selectedDocReports.docTableId || this.selectedDocReports.indexSet.size < 2) {\r\n        this.$toast(this.$t(\"submodules.reports.select_minimum_two_report\"), {type: \"warning\"})\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    async handleCollect() {\r\n      this.loader = true;\r\n      this.collectedReportForTableReport = [];\r\n      this.docTableFieldsOriginal = [];\r\n      this.docTableFieldsSerialized = [];\r\n      if (!this.handleValidateForCollecting()) {\r\n        this.loader = false;\r\n        return;\r\n      }\r\n      await reportService.getByIdTable(this.selectedDocReports.docTableId).then(async response => {\r\n        if (response.data.columns.length > 0) {\r\n          this.docTableFieldsOriginal = response.data.columns;\r\n          this.deserializeDocTableFields(this.docTableFieldsOriginal);\r\n          this.selectedDocReports.docTable = response.data.table;\r\n        }\r\n        this.$bvModal.show('modal')\r\n        await this.handleCollectView();\r\n        this.loader = false;\r\n      }).catch(() => {\r\n        this.loader = false;\r\n      });\r\n    },\r\n    deserializeDocTableFields(list, clear = true) {\r\n      if (clear) {\r\n        this.docTableFieldsSerialized = [];\r\n      }\r\n      list.forEach(e => {\r\n        if (e.children.length > 0) {\r\n          this.deserializeDocTableFields(e.children, false);\r\n        } else {\r\n          this.docTableFieldsSerialized.push(e)\r\n          if (e.typeCode === 'SELECT') {\r\n            this.selectOptionsByReferenceUrl[e.id] = [];\r\n          }\r\n        }\r\n      })\r\n    },\r\n    async handleCollectView() {\r\n      if (!this.handleValidateForCollecting()) {\r\n        return;\r\n      }\r\n      this.loader = true;\r\n      this.selectedDocReports.docReports = {};\r\n      await this.selectedDocReports.indexSet.forEach((docReportId) => {\r\n        this.selectedDocReports.docReports[docReportId] = {}\r\n        reportService.getReportById(docReportId).then(response => {\r\n          if (response.data) {\r\n            response.data.map(value => {\r\n              if (this.selectedDocReports.docReports[docReportId][value.rowId] === undefined) {\r\n                this.selectedDocReports.docReports[docReportId][value.rowId] = {};\r\n              }\r\n              this.selectedDocReports.docReports[docReportId][value.rowId][value.columnId] = value;\r\n            });\r\n          }\r\n        });\r\n      })\r\n    },\r\n    handleCollectedReportDraw() {\r\n      this.collectedReportForTableReport = [];\r\n      switch (this.collectingType) {\r\n        case 'ASSEMBLE':\r\n          this.handleCollectedReportDrawAssemble();\r\n          break;\r\n        case 'COLLECT_SUM':\r\n          this.handleCollectedReportDrawCollectSum();\r\n          break;\r\n        case 'COLLECT_AVG':\r\n          this.handleCollectedReportDrawCollectAvg();\r\n          break;\r\n      }\r\n    },\r\n    handleCollectedReportDrawAssemble() {\r\n      let sequence = 1;\r\n      this.selectedDocReports.indexSet.forEach((value) => {\r\n        const reports = this.selectedDocReports.docReports[value];\r\n        for (const reportRowIndex in reports) {\r\n          const reportRow = reports[reportRowIndex];\r\n          let reportRowData = JSON.parse('[]');\r\n          this.docTableFieldsSerialized.forEach(field => {\r\n            if (reportRow[field.id] !== undefined) {\r\n              reportRowData.push(reportRow[field.id]);\r\n            } else {\r\n              if (field.typeCode === 'SEQUENCE') {\r\n                reportRowData.push({\r\n                  value: sequence,\r\n                  typeCode: field.typeCode,\r\n                });\r\n                sequence++;\r\n              } else {\r\n                reportRowData.push({});\r\n              }\r\n            }\r\n          })\r\n          this.collectedReportForTableReport.push(reportRowData);\r\n        }\r\n      })\r\n    },\r\n    handleCollectedReportDrawCollectSum() {\r\n      let sequence = 1;\r\n      this.selectedDocReports.indexSet.forEach((docReportId) => {\r\n        let reportData = [];\r\n        let sumBigIntegerCount = {};\r\n        const reports = this.selectedDocReports.docReports[docReportId];\r\n        for (const reportRowIndex in reports) {\r\n          const report = reports[reportRowIndex];\r\n          this.docTableFieldsSerialized.forEach((docTableField, docTableFieldIndex) => {\r\n            const reportRowField = report[docTableField.id];\r\n            if (docTableField.typeCode === 'SEQUENCE' && typeof reportData[docTableFieldIndex] === 'undefined') {\r\n              reportData[docTableFieldIndex] = {\r\n                value: sequence,\r\n                typeCode: \"SEQUENCE\"\r\n              }\r\n            }\r\n            reportData[docTableFieldIndex] = reportRowField && !reportData[docTableFieldIndex]?.id ? JSON.parse(JSON.stringify(reportRowField)) : (reportData[docTableFieldIndex] || {});\r\n            if (docTableField.typeCode === 'BIGDECIMAL') {\r\n              const valueBigDecimal = reportRowField?.valueBigDecimal ?? 0;\r\n              if (typeof sumBigIntegerCount[docTableField.id] === 'undefined') {\r\n                sumBigIntegerCount[docTableField.id] = 0;\r\n              }\r\n              if (typeof reportData[docTableFieldIndex].valueBigDecimal === 'undefined' || reportData[docTableFieldIndex].valueBigDecimal === null || reportData[docTableFieldIndex].valueBigDecimal === '') {\r\n                reportData[docTableFieldIndex].valueBigDecimal = 0;\r\n              }\r\n              if (valueBigDecimal && (valueBigDecimal > 0 || valueBigDecimal < 0)) {\r\n                sumBigIntegerCount[docTableField.id]++;\r\n              }\r\n              if (valueBigDecimal && reportRowField?.id !== reportData[docTableFieldIndex]?.id) {\r\n                reportData[docTableFieldIndex].valueBigDecimal += valueBigDecimal;\r\n                reportData[docTableFieldIndex].value = reportData[docTableFieldIndex].valueBigDecimal?.toString();\r\n              }\r\n            } else if (docTableField.typeCode === 'STRING' || docTableField.typeCode === 'DATE' || docTableField.typeCode === 'YEAR' || docTableField.typeCode === 'BOOLEAN') {\r\n              reportData[docTableFieldIndex].value += \", \" + (reportRowField.value ?? '');\r\n              reportData[docTableFieldIndex].valueDate += \", \" + (reportRowField.valueDate ?? '');\r\n              reportData[docTableFieldIndex].valueString += \", \" + (reportRowField.valueString ?? '');\r\n              reportData[docTableFieldIndex].valueBoolean += \", \" + (reportRowField.valueBoolean ?? '');\r\n            } else if (docTableField.typeCode === 'SELECT') {\r\n              if (!reportData[docTableFieldIndex]) {\r\n                reportData[docTableFieldIndex] = JSON.parse(JSON.stringify(reportRowField));\r\n              }\r\n              reportData[docTableFieldIndex].id = reportRowField.id;\r\n              reportData[docTableFieldIndex].rowId = reportRowField.rowId;\r\n              // reportData[docTableFieldIndex].typeCode = 'STRING';\r\n              reportData[docTableFieldIndex].columnId = reportRowField.columnId;\r\n              reportData[docTableFieldIndex].docReportId = reportRowField.docReportId;\r\n              reportData[docTableFieldIndex].selectValueId = null;\r\n              if (reportData[docTableFieldIndex]?.valueString?.indexOf(reportRowField.selectValueNameUz) === -1) {\r\n                if (reportRowField?.selectValueNameUz) {\r\n                  reportData[docTableFieldIndex].valueString += (reportRowField?.selectValueNameUz ?? '') + \", \";\r\n                  reportData[docTableFieldIndex].value += (reportRowField?.selectValueNameUz ?? '') + \", \";\r\n                  reportData[docTableFieldIndex].selectValueNameUz += (reportRowField?.selectValueNameUz ?? '') + \", \";\r\n                }\r\n                if (reportRowField?.selectValueNameEn) {\r\n                  reportData[docTableFieldIndex].selectValueNameEn += (reportRowField?.selectValueNameEn ?? '') + \", \";\r\n                }\r\n                if (reportRowField?.selectValueNameLt) {\r\n                  reportData[docTableFieldIndex].selectValueNameLt += (reportRowField?.selectValueNameLt ?? '') + \", \";\r\n                }\r\n                if (reportRowField?.selectValueNameRu) {\r\n                  reportData[docTableFieldIndex].selectValueNameRu += (reportRowField?.selectValueNameRu ?? '') + \", \";\r\n                }\r\n              } else if (reportData[docTableFieldIndex]?.valueString === null) {\r\n                reportData[docTableFieldIndex].valueString = '';\r\n              }\r\n            }\r\n          })\r\n        }\r\n        this.collectedReportForTableReport.push(reportData);\r\n        sequence++;\r\n      })\r\n    },\r\n    handleCollectedReportDrawCollectAvg() {\r\n      let sequence = 1;\r\n      this.selectedDocReports.indexSet.forEach((docReportId) => {\r\n        let reportData = [];\r\n        let sumBigIntegerCount = {};\r\n        const reports = this.selectedDocReports.docReports[docReportId];\r\n        for (const reportRowIndex in reports) {\r\n          const report = reports[reportRowIndex];\r\n          this.docTableFieldsSerialized.forEach((docTableField, docTableFieldIndex) => {\r\n            const reportRowField = report[docTableField.id];\r\n            if (docTableField.typeCode === 'SEQUENCE' && typeof reportData[docTableFieldIndex] === 'undefined') {\r\n              reportData[docTableFieldIndex] = {\r\n                value: sequence,\r\n                typeCode: \"SEQUENCE\"\r\n              }\r\n            }\r\n            reportData[docTableFieldIndex] = reportRowField && !reportData[docTableFieldIndex]?.id ? JSON.parse(JSON.stringify(reportRowField)) : (reportData[docTableFieldIndex] || {});\r\n            if (docTableField.typeCode === 'BIGDECIMAL') {\r\n              const valueBigDecimal = reportRowField?.valueBigDecimal ?? 0;\r\n              if (typeof sumBigIntegerCount[docTableField.id] === 'undefined') {\r\n                sumBigIntegerCount[docTableField.id] = 0;\r\n              }\r\n              if (typeof reportData[docTableFieldIndex].valueBigDecimal === 'undefined' || reportData[docTableFieldIndex].valueBigDecimal === null || reportData[docTableFieldIndex].valueBigDecimal === '') {\r\n                reportData[docTableFieldIndex].valueBigDecimal = 0;\r\n              }\r\n              if (this.collectionAvgIgnoreZero) {\r\n                if (valueBigDecimal && (valueBigDecimal > 0 || valueBigDecimal < 0)) {\r\n                  sumBigIntegerCount[docTableField.id]++;\r\n                }\r\n              } else {\r\n                sumBigIntegerCount[docTableField.id]++;\r\n              }\r\n              if (valueBigDecimal && reportRowField?.id !== reportData[docTableFieldIndex]?.id) {\r\n                reportData[docTableFieldIndex].valueBigDecimal += valueBigDecimal;\r\n                reportData[docTableFieldIndex].value = reportData[docTableFieldIndex].valueBigDecimal?.toString();\r\n              }\r\n            } else if (docTableField.typeCode === 'STRING' || docTableField.typeCode === 'DATE' || docTableField.typeCode === 'YEAR' || docTableField.typeCode === 'BOOLEAN') {\r\n              reportData[docTableFieldIndex].value += \", \" + (reportRowField.value ?? '');\r\n              reportData[docTableFieldIndex].valueDate += \", \" + (reportRowField.valueDate ?? '');\r\n              reportData[docTableFieldIndex].valueString += \", \" + (reportRowField.valueString ?? '');\r\n              reportData[docTableFieldIndex].valueBoolean += \", \" + (reportRowField.valueBoolean ?? '');\r\n            } else if (docTableField.typeCode === 'SELECT') {\r\n              if (!reportData[docTableFieldIndex]) {\r\n                reportData[docTableFieldIndex] = JSON.parse(JSON.stringify(reportRowField));\r\n              }\r\n              reportData[docTableFieldIndex].id = reportRowField.id;\r\n              reportData[docTableFieldIndex].rowId = reportRowField.rowId;\r\n              // reportData[docTableFieldIndex].typeCode = 'STRING';\r\n              reportData[docTableFieldIndex].columnId = reportRowField.columnId;\r\n              reportData[docTableFieldIndex].docReportId = reportRowField.docReportId;\r\n              if (reportData[docTableFieldIndex]?.valueString?.indexOf(reportRowField.selectValueNameUz) === -1) {\r\n                if (reportRowField?.selectValueNameUz) {\r\n                  reportData[docTableFieldIndex].value += (reportRowField?.selectValueNameUz ?? '') + \", \";\r\n                  reportData[docTableFieldIndex].valueString += (reportRowField?.selectValueNameUz ?? '') + \", \";\r\n                  reportData[docTableFieldIndex].selectValueNameUz += (reportRowField?.selectValueNameUz ?? '') + \", \";\r\n                }\r\n                if (reportRowField?.selectValueNameEn) {\r\n                  reportData[docTableFieldIndex].selectValueNameEn += (reportRowField?.selectValueNameEn ?? '') + \", \";\r\n                }\r\n                if (reportRowField?.selectValueNameLt) {\r\n                  reportData[docTableFieldIndex].selectValueNameLt += (reportRowField?.selectValueNameLt ?? '') + \", \";\r\n                }\r\n                if (reportRowField?.selectValueNameRu) {\r\n                  reportData[docTableFieldIndex].selectValueNameRu += (reportRowField?.selectValueNameRu ?? '') + \", \";\r\n                }\r\n              } else if (reportData[docTableFieldIndex]?.valueString === null) {\r\n                reportData[docTableFieldIndex].valueString = '';\r\n                reportData[docTableFieldIndex].value = '';\r\n              }\r\n            }\r\n          })\r\n        }\r\n        for (const i in reportData) {\r\n          const count = sumBigIntegerCount[reportData[i].columnId];\r\n          if (reportData[i].typeCode === 'BIGDECIMAL' && count > 0) {\r\n            reportData[i].valueBigDecimal /= count;\r\n          }\r\n          reportData[i].selectValueNameEn = reportData[i].selectValueNameEn ? reportData[i].selectValueNameEn.trim().slice(0, -1) : '';\r\n          reportData[i].selectValueNameLt = reportData[i].selectValueNameLt ? reportData[i].selectValueNameLt.trim().slice(0, -1) : '';\r\n          reportData[i].selectValueNameRu = reportData[i].selectValueNameRu ? reportData[i].selectValueNameRu.trim().slice(0, -1) : '';\r\n          reportData[i].selectValueNameUz = reportData[i].selectValueNameUz ? reportData[i].selectValueNameUz.trim().slice(0, -1) : '';\r\n        }\r\n        this.collectedReportForTableReport.push(reportData);\r\n        sequence++;\r\n      })\r\n    },\r\n    selectDocReportItem(index) {\r\n      const item = this.tableList[index];\r\n      if (this.selectedDocReports.docTableId === false) {\r\n        this.selectedDocReports.docTableId = item.docTableId;\r\n      }\r\n      if (this.selectedDocReports.indexSet.has(item.reportId)) {\r\n        if (this.selectedDocReports.docTableId === item.docTableId) {\r\n          this.selectedDocReports.indexSet.delete(item.reportId);\r\n          this.tableList[index].selected = false;\r\n        }\r\n      } else {\r\n        if (this.selectedDocReports.docTableId === item.docTableId) {\r\n          this.selectedDocReports.indexSet.add(item.reportId);\r\n          this.tableList[index].selected = true;\r\n        }\r\n      }\r\n      if (this.selectedDocReports.indexSet.size === 0) {\r\n        this.selectedDocReports.docTableId = false;\r\n      }\r\n    },\r\n    printColumn(column, index) {\r\n      switch (column.typeCode) {\r\n        case 'SEQUENCE':\r\n          return column?.value ?? index + 1;\r\n        case 'STRING':\r\n          return column?.valueString ?? column?.value ?? '';\r\n        case 'BIGDECIMAL':\r\n          // eslint-disable-next-line no-case-declarations\r\n          let v = column?.valueBigDecimal ?? 0;\r\n          v = v.toFixed(2);\r\n          if (!isNaN(v)) {\r\n            return v;\r\n          }\r\n          return '';\r\n        case 'BOOLEAN':\r\n          return column?.valueBoolean ? this.$t('actions.yes') : this.$t('actions.no');\r\n        case 'DATE':\r\n          return column?.valueDate ?? '';\r\n        case 'YEAR':\r\n          return column?.valueString ?? '';\r\n        case 'SELECT':\r\n          return this.getName({\r\n            nameUz: column?.selectValueNameUz,\r\n            nameRu: column?.selectValueNameRu,\r\n            nameLt: column?.selectValueNameLt,\r\n          }).trim(' ,');\r\n        default:\r\n          return '';\r\n      }\r\n    },\r\n    async getTableList() {\r\n      if (this.params.docTableId && this.params.dateTypeId) {\r\n        this.tableListLength = 0;\r\n        this.tableListLength = 0;\r\n        this.tableList = [];\r\n        this.loader = true\r\n        await reportService.reportListForCollection(this.params.docTableId, this.params.dateTypeId, {...this.var_default_search_payload}).then(response => {\r\n          if (response.data.list.length > 0) {\r\n            this.tableListLength = response.data.total;\r\n            this.tableList = response.data.list.map((item) => {\r\n              return {...item, selected: this.selectedDocReports.indexSet.has(item.reportId)};\r\n            });\r\n          } else {\r\n            this.tableListLength = 0;\r\n            this.tableList = [];\r\n          }\r\n        }).finally(() => {\r\n          this.loader = false;\r\n        });\r\n      }\r\n    },\r\n    handleExportExcel() {\r\n      let currentDate = new Date();\r\n      let dateDMY = currentDate.getDate() + '-' + (currentDate.getMonth() + 1) + '-' + currentDate.getFullYear();\r\n      let fileName = this.getName(this.selectedDocReports.docTable) + dateDMY;\r\n      let table = this.$refs.collectedReportTable;\r\n      table.setAttribute('border', '1');\r\n      table.style.border = '1px solid black';\r\n      table.children?.forEach(theadOrTbody => {\r\n        theadOrTbody.children.forEach(tr => {\r\n          tr.children.forEach(thOrTd => {\r\n            thOrTd.width = thOrTd.offsetWidth + 'px';\r\n            thOrTd.style.width = thOrTd.offsetWidth + 'px';\r\n          })\r\n        })\r\n      })\r\n      let wb = XLSX.utils.table_to_book(table, {sheet: \"sheet1\"});\r\n      setTimeout(() => { // todo nega bu kerakligini tekshirish kerak, copy olib qoyganman\r\n        this.loaderExcel = false;\r\n      }, 500);\r\n      return XLSX.writeFile(wb, `${fileName}.xlsx`, {});\r\n    },\r\n    handleSaveDataOpenModal() {\r\n      this.$bvModal.show('saveDataModal')\r\n    },\r\n    handleSaveData(e) {\r\n      this.computedObServerSaveData.validate().then(isValid => {\r\n        if (!isValid) {\r\n          return false;\r\n        }\r\n        this.loader = true\r\n        let data = [];\r\n        for (const key in this.collectedReportForTableReport) {\r\n          for (const val of this.collectedReportForTableReport[key]) {\r\n            if (!val.typeCode || val.typeCode === 'SEQUENCE' || !val.columnId || !val.docReportId) {\r\n              continue;\r\n            }\r\n            if (val.typeCode === 'SELECT' && typeof val.selectValueId === 'object') {\r\n              const selectValue = val.selectValueId;\r\n              data.push({\r\n                ...val,\r\n                dynamicRowId: key + 1,\r\n                selectValueId: selectValue?.id,\r\n                value: null,\r\n                valueString: null,\r\n                selectValueNameUz: selectValue?.nameUz ?? selectValue?.name ?? '',\r\n                selectValueNameRu: selectValue?.nameRu ?? selectValue?.name ?? '',\r\n                selectValueNameLt: selectValue?.nameLt ?? selectValue?.name ?? '',\r\n                selectValueNameEn: selectValue?.nameEn ?? selectValue?.name ?? '',\r\n                rowId: null\r\n              })\r\n              continue;\r\n            }\r\n            data.push({\r\n              ...val,\r\n              dynamicRowId: key + 1,\r\n              rowId: null\r\n            })\r\n          }\r\n        }\r\n        const info = {\r\n          ...this.saveData.reportInfoForGather,\r\n          tableId: this.params.docTableId,\r\n          dateTypeId: this.params.dateTypeId,\r\n          gatherType: this.collectingType,\r\n        }\r\n        reportService.createAndFillGatherReport(info, data)\r\n            .then((res) => {\r\n              this.$toast(this.$t('messages.saved_successfully'), {type: 'success'});\r\n            })\r\n            .finally(() => {\r\n              this.loader = false\r\n              this.$bvModal.hide('saveDataModal')\r\n            })\r\n      })\r\n    },\r\n    ownDocTablesValue(opt) {\r\n      let item = this.ownDocTableListOptions.find(e => e.value === opt);\r\n      return item.text ?? ''\r\n    },\r\n    labelCollectedSelect({nameUz, nameLt, nameRu, name}) {\r\n      return nameUz ? this.getName({nameUz: nameUz, nameLt: nameLt, nameRu: nameRu}) : name\r\n    },\r\n    findFieldById(id) {\r\n      return this.docTableFieldsSerialized.find(e => e.id === id);\r\n    },\r\n    async selectFetchOptions(column, keyword) {\r\n      clearTimeout(this.selectLoadItemTimeOut);\r\n      this.selectLoadItemTimeOut = setTimeout(async () => {\r\n        this.selectLoadItemLoader = true;\r\n        const field = this.findFieldById(column.columnId);\r\n        crudAndListsService.searchListWithKeyword(field.referenceUrl, {\r\n          keyword: keyword,\r\n          itemsPerPage: 10,\r\n          page: 1\r\n        }, field.referenceAppendUrl)\r\n            .then(res => {\r\n              if (\"DepartmentForDocument\" === field.refCode) {\r\n                this.selectOptionsByReferenceUrl[field.id] = res.data\r\n              } else {\r\n                this.selectOptionsByReferenceUrl[field.id] = res.data.list\r\n              }\r\n            })\r\n            .catch(err => {\r\n              this.selectLoadItemLoader = false;\r\n            })\r\n            .finally(() => {\r\n              this.selectLoadItemLoader = false;\r\n            })\r\n      }, 500);\r\n    },\r\n  },\r\n  computed: {\r\n    ownDocTableListOptions() {\r\n      if (this.ownDocTableList.length > 0) {\r\n        return this.ownDocTableList.map(item => {\r\n          return {\r\n            text: this.getName({\r\n              nameUz: item.nameUz,\r\n              nameRu: item.nameRu,\r\n              nameLt: item.nameLt,\r\n            }),\r\n            value: item.id,\r\n          };\r\n        });\r\n      }\r\n      return [];\r\n    },\r\n    ownDateTypeListOptions() {\r\n      if (this.dateTypeList.length > 0) {\r\n        return this.dateTypeList.map(item => {\r\n          return {\r\n            text: this.getName({\r\n              nameUz: item.nameUz,\r\n              nameRu: item.nameRu,\r\n              nameLt: item.nameLt,\r\n            }),\r\n            value: item.id,\r\n          };\r\n        });\r\n      }\r\n      return [];\r\n    },\r\n    computedObServerSaveData() {\r\n      return this.$refs.obServerSaveData\r\n    }\r\n  },\r\n  watch: {\r\n    async 'params.docTableId'(docTableId) {\r\n      const {dateTypeId} = this.ownDocTableList.find(e => e.id === docTableId);\r\n      if (dateTypeId) {\r\n        this.loader = true\r\n        await this.getDateTypeList(dateTypeId)\r\n      } else {\r\n        this.dateTypeList = [];\r\n      }\r\n    },\r\n    'var_default_search_payload.page'() {\r\n      if (this.loader) {\r\n        return;\r\n      }\r\n      this.handleSearch(false);\r\n    },\r\n  }\r\n};\r\n</script>\r\n"]}]}